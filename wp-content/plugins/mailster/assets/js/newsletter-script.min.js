jQuery(document).ready(function(M){var ab=M(window),B=M("body"),y=M("#mailster_iframe"),U=M("#template-wrap"),Z,l,w=M("#mailster_template .inside"),e=!!M("#mailster_disabled").val(),R=M("#title"),J=M("#mailster_subject"),W=M("#mailster_preheader"),T=M("#content"),a=M("#excerpt"),Y=M("#modules"),aa=M("#plain-text-wrap"),I=M("#html-wrap"),m=M("#head"),q=M("#optionbar"),D=[],S=M("#post_ID").val(),ak=0,b=M("#clickmap-stats"),Q=M('[name^="mailster_data"]'),A=M("#mailster_nonce").val(),C=false,af,z,E,f,h,H,ac=M.browser.webkit?B:M("html"),s,j,ah=false,r="ontouchstart" in document.documentElement,i=typeof tinymce=="object";function ag(){F(true);ad();l=(y[0].contentWindow||y[0].contentDocument);if(l.document){l=l.document}V();var ao=setTimeout(function(){if(!C){y.trigger("load")}},5000);y.load(function(){if(C){return false}if(!e){if(!f){f=new ae()}if(!H){H=new an()}if(!E){E=new am()}}else{}x();C=true;v();K(0,0);u();clearInterval(ao);if(typeof autosaveLast!="undefined"){window.autosaveLast=(typeof wp!="undefined"&&wp.autosave)?wp.autosave.getCompareString():R.val()+T.val()+a.val()}if(typeof wp!="undefined"){if(wp.autosave&&wp.autosave.server&&typeof wp.autosave.server.postChanged=="function"){window.mailster_autosave=O();wp.autosave.server.postChanged=function(){return window.mailster_autosave!=O()}}}Z=y.contents().find("body");if(e){R.prop("disabled",true);window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;Z.on("click","a",function(){window.open(this.href);return false})}else{}ab.trigger("resize");M("#normal-sortables").on("sortupdate",function(ap,aq){ab.trigger("resize")});U.removeClass("load")});ab.on("resize.mailster",v);window.mailster_refresh=function(){v();u()};window.mailster_hideButtons=function(){w.find(".content.mailster-btn").remove()};if(/post_status=autoresponder/.test(M("#referredby").val())||/post_status=autoresponder/.test(location.search)){M("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(M.browser.msie){B.addClass("ie")}if(r){B.addClass("touch")}}function V(){B.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){ab.trigger("resize")});if(!e){R.change(function(){if(!J.val()){J.val(M(this).val())}});M("#use_pwd").on("change",function(){M("#password-wrap").slideToggle(200).find("input").focus().select();M("#post_password").prop("disabled",!M(this).is(":checked"))});M("#post").on("submit",function(){if(ah){return false}u()});M(".sendnow-button").on("click",function(){if(!confirm(mailsterL10n.send_now)){return false}});M("#local-storage-notice").on("click",".restore-backup, .undo-restore-backup",function(){F();setTimeout(function(){var aq=T.val();if(!aq){C=E=false;y[0].contentWindow.location.reload()}else{P(aq,false);x();v()}M("#local-storage-notice").slideUp()},100);return false}).find(".restore-backup").off("click.autosave-local");M("#mailster_delivery").on("change","input.timezone",function(){M(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){M(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var aq=M(this).parent().parent().parent();aq.find("span").toggleClass("disabled")});M("#editbar, #mailster_delivery").on("change",".dynamic_embed_options_taxonomy",function(){var aq=M(this),ar=aq.val();aq.parent().find(".button").remove();if(ar!=-1){if(aq.parent().find("select").length<aq.find("option").length-1){M(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(aq)}}else{aq.parent().html("").append(aq)}return false}).on("click",".add_embed_options_taxonomy",function(){var ar=M(this),aq=ar.prev().clone();aq.insertBefore(ar).val("-1");M("<span> "+mailsterL10n.or+" </span>").insertBefore(aq);ar.remove();return false});M("#autoresponder-post_type").on("change",function(){var aq=M("#autoresponder-taxonomies");aq.find("select").prop("disabled",true);N("get_post_term_dropdown",{labels:false,names:true,posttype:M(this).val()},function(ar){if(ar.success){aq.html(ar.html)}},function(ar,au,at){loader(false);alert(au+" "+ar.status+": "+at+"\n\n"+mailsterL10n.check_console)})});M(".default-value").on("click",function(){var aq=M(this);M("#"+aq.data("for")).val(aq.data("value"))});M(".category-tabs").on("click","a",function(){var ar=M(this),aq=ar.attr("href");M("#mailster_delivery").find(".tabs-panel").hide();M("#mailster_delivery").find(".tabs").removeClass("tabs");ar.parent().addClass("tabs");M(aq).show();M("#mailster_is_autoresponder").val((aq=="#autoresponder")?1:"");return false});M(".mailster_sendtest").on("click",function(){var ar=M(this),aq=M("#delivery-ajax-loading").css({display:"inline"});ar.prop("disabled",true);u();N("send_test",{formdata:M("#post").serialize(),to:M("#mailster_testmail").val(),content:T.val(),plaintext:a.val()},function(at){aq.hide();ar.prop("disabled",false);var au=M('<div class="'+((!at.success)?"error":"updated")+'"><p>'+at.msg+"</p></div>").hide().prependTo(ar.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){au.remove()})},function(at,aw,au){aq.hide();ar.prop("disabled",false);var av=M('<div class="error"><p>'+aw+" "+at.status+": "+au+"</p></div>").hide().prependTo(ar.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})})});M(".mailster_spamscore").on("click",function(){var av=M(this),aq=M("#delivery-ajax-loading").css({display:"inline"}),au=M("#spam_score_progress").removeClass("spam-score").slideDown(200),at=au.find(".bar");av.prop("disabled",true);M(".score").html("");u();at.css({width:"0"}).css({width:"20%"});N("send_test",{spamtest:true,formdata:M("#post").serialize(),to:M("#mailster_testmail").val(),content:T.val(),plaintext:a.val()},function(aw){if(aw.success){at.css({width:"40%"});ar(aw.id,1)}else{aq.hide();au.slideUp(200);var ax=M('<div class="error"><p>'+aw.msg+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})}},function(aw,az,ax){aq.hide();av.prop("disabled",false);var ay=M('<div class="error"><p>'+az+" "+aw.status+": "+ax+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})});function ar(ax,aw){N("check_spam_score",{ID:ax},function(az){if(az.score){aq.hide();av.prop("disabled",false);au.addClass("spam-score");at.css({width:(parseFloat(az.score)*10)+"%"},400);M(".score").html("<strong>"+p(mailsterL10n.yourscore,az.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((az.score/10)*mailsterL10n.yourscores.length)])}else{if(aw<=5&&!az.abort){var ay=(aw*10)+50;at.css({width:(ay)+"%"},aw*400+5000);setTimeout(function(){ar(ax,++aw)},aw*400)}else{aq.hide();av.prop("disabled",false);at.css({width:"100%"},10);au.slideUp(200);var aA=M('<div class="error"><p>'+az.msg+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aA.remove()})}}},function(ay,aB,az){aq.hide();av.prop("disabled",false);var aA=M('<div class="error"><p>'+aB+" "+ay.status+": "+az+"</p></div>").hide().prependTo(av.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aA.remove()})})}});M("#mailster_data_active").on("change",function(){var aq=M(this).is(":checked");(aq)?M(".active_wrap").addClass("disabled"):M(".active_wrap").removeClass("disabled");M(".deliverydate, .deliverytime").prop("disabled",!aq)});M("#mailster_data_autoresponder_active").on("change",function(){var aq=M(this).is(":checked");(aq)?M(".autoresponder_active_wrap").addClass("disabled"):M(".autoresponder_active_wrap").removeClass("disabled")});var ao=M("input.color");var ap=M(".colors").data("original-colors");ao.wpColorPicker({color:true,width:250,mode:"hsl",palettes:ap,change:function(aq,ar){M(this).val(ar.color.toString()).trigger("change")},clear:function(aq,ar){}});M(".wp-color-result").on("click",function(){M(this).closest("li.mailster-color").addClass("open")});ao.on("change",function(){var ar=M(this);var aq=ar.data("value");L(aq,ar.val(),ar)});if(typeof jQuery.datepicker=="object"){M("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var aq=M(this).datepicker("getDate");M(".deliverydate").html(M(this).val())}});M("input.datepicker.nolimit").datepicker("option","minDate",null)}else{M("input.datepicker").prop("readonly",false)}M("input.datepicker").on("focus",function(){M(this).removeClass("inactive").trigger("click")}).on("blur",function(){M(".deliverydate").html(M(this).val());M(this).addClass("inactive")}).on("change",function(){});M("input.deliverytime").on("blur",function(){M(document).unbind(".mailster_deliverytime")}).on("focus, click",function(av){var aw=M(this),ar=M(this)[0],aq=aw.offset().left,ax=0,au=0,at=2;if(av.clientX-aq>23){ax=1,au=3,at=5}M(document).unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(ay){if(ay.keyCode==9){return(ax=!ax)?!j(ar,3,5):(ay.shiftKey)?!j(ar,0,2):true}}).on("keyup.mailster_deliverytime",function(ay){if(aw.val().length==1){aw.val(aw.val()+":00");j(ar,1,1)}if(document.activeElement.selectionStart==2){if(aw.val().substr(0,2)>23){aw.trigger("change");return false}j(ar,3,5)}});j(ar,au,at)}).on("change",function(){var ar=M(this),at=ar.val(),aq;ar.addClass("inactive");if(!/^\d+:\d+$/.test(at)){if(at.length==1){at="0"+at+":00"}else{if(at.length==2){at=at+":00"}else{if(at.length==3){at=at.substr(0,2)+":"+at.substr(2,3)+"0"}else{if(at.length==4){at=at.substr(0,2)+":"+at.substr(2,4)}}}}}aq=at.split(":");if(!/\d\d:\d\d$/.test(at)&&at!=""||aq[0]>23||aq[1]>59){ar.val("00:00").focus();j(ar[0],0,2)}else{ar.val(at)}});M("#mailster_autoresponder_action").on("change",function(){M("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+M(this).val())});M("#mailster_autoresponder_advanced_check").on("change",function(){M("#mailster_autoresponder_advanced").slideToggle()});M("#time_extra").on("change",function(){M("#autoresponderfield-mailster_timebased_advanced").slideToggle()});M("#mailster_attachments").on("click",".delete-attachment",function(){event.preventDefault();M(this).parent().remove()}).on("click",".add-attachment",function(){event.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var ar=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),aq=M(".mailster-attachment").eq(0).clone();aq.find("img").attr("src",ar.icon);aq.find(".mailster-attachment-label").html(ar.filename);aq.find("input").attr("name","mailster_data[attachments][]").val(ar.id);aq.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});M("#mailster_autoresponder_advanced").on("click",".add-condition",function(){var aq=M(".mailster_autoresponder_condition"),at=aq.length,ar=aq.last().clone();ar.hide().removeAttr("id").insertAfter(aq.last()).slideDown();M.each(ar.find("input, select"),function(){var au=M(this).val("").attr("name");M(this).attr("name",au.replace(/\[\d+\]/,"["+at+"]"))})}).on("click",".remove-condition",function(){M(this).parent().parent().slideUp(function(){M(this).remove()})});M("#autoresponder_wrap").on("click",".mailster_autoresponder_timebased-end-schedule",function(){var aq=M(this).is(":checked");(aq)?M(".mailster_autoresponder_timebased-end-schedule-field").slideDown():M(".mailster_autoresponder_timebased-end-schedule-field").slideUp()});M("#mailster_receivers").on("change","input.list",function(){var ar=[],ax=[],at=M("#list-checkboxes").find("input, select"),au=M("#list-checkboxes").find("input.list"),aq=M("#list_extra"),aw={},av=M("#mailster_total");M("input.list-parent-"+M(this).val()).prop("checked",M(this).prop("checked"));M.each(au,function(){var ay=M(this).val();if(M(this).is(":checked")){ar.push(ay)}});aw.lists=ar;aw.ignore_lists=M("#ignore_lists").is(":checked");if(aq.is(":checked")){M.each(M(".mailster_list_condition"),function(){var aA=M(this),ay=aA.find("select"),az=aA.find("input");ax.push({field:ay.eq(0).val(),operator:ay.eq(1).val(),value:az.eq(0).val()})});aw.operator=M("#mailster_list_operator").val();aw.conditions=ax}av.addClass("loading");F();N("get_totals",aw,function(ay){x();av.removeClass("loading").html(ay.totalformated)},function(ay,aA,az){x();av.removeClass("loading").html("?");alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)})}).on("change","#all_lists",function(){M("#list-checkboxes").find("input.list").prop("checked",M(this).is(":checked")).eq(0).trigger("change")}).on("change","#ignore_lists",function(){var aq=M(this).is(":checked");M("#list-checkboxes").each(function(){(aq)?M(this).slideUp(200):M(this).slideDown(200)}).find("input.list").eq(0).trigger("change")}).on("change","#mailster_list_operator",function(){M("#mailster_list_conditions").removeClass("operator-is-OR operator-is-AND").addClass("operator-is-"+M(this).val())});M("#mailster_total").on("click",function(){M("#list-checkboxes").find("input.list").eq(0).trigger("change")});M("#mailster_list_advanced").on("click",".add-condition",function(){var aq=M(".mailster_list_condition"),at=aq.length,ar=aq.last().clone();ar.hide().removeAttr("id").insertAfter(aq.last()).slideDown();M.each(ar.find("input, select"),function(){var au=M(this).prop("disabled",false).val("").attr("name");M(this).attr("name",au.replace(/\[\d+\]/,"["+at+"]")).removeClass("hasDatepicker").removeAttr("id")})}).on("click",".remove-condition",function(){M(this).parent().parent().slideUp(function(){M(this).remove();M("#list-checkboxes").find("input.list").eq(0).trigger("change")})}).on("change","select.condition-operator",function(){M(this).prev("select.condition-field").trigger("change")}).on("change.datefields","select.condition-field",function(){var ar=M(this),aq=M(this).next("select.condition-operator");if(typeof jQuery.datepicker!="object"){return}if(ar.parent().find("input").data("datepicker")){ar.parent().find("input").datepicker("destroy")}if(/pattern/.test(aq.val())){return}if(M.inArray(ar.val(),mailsterdata.datefields)!==-1){ar.parent().find("input").datepicker({dateFormat:"yy-mm-dd",firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn"})}}).on("change","select, input",function(){M("#list-checkboxes").find("input.list").eq(0).trigger("change")}).find("select.condition-field").trigger("change.datefields");M("#list_extra").on("change",function(){if(M(this).is(":checked")){M("#mailster_list_advanced").slideDown()}else{M("#mailster_list_advanced").slideUp()}M("#list-checkboxes").find("input.list").eq(0).trigger("change")});M("#mailster_options").on("click","a.default-value",function(){var ar=M(this).prev().find("input"),aq=ar.data("default");ar.wpColorPicker("color",aq);return false}).on("click","ul.colorschema",function(){var ar=M("#mailster_options").find("input.color"),aq=M(this).find("li.colorschema-field");F();M.each(aq,function(au){var at=aq.eq(au).data("hex");ar.eq(au).wpColorPicker("color",at)});x()}).on("click","a.savecolorschema",function(){var ar=M.map(M("#mailster_options").find(".color"),function(at){return M(at).val()});var aq=M("#colorschema-ajax-loading").css({display:"inline"});N("save_color_schema",{template:M("#mailster_template_name").val(),colors:ar},function(at){aq.hide();if(at.success){M(".colorschema").last().after(M(at.html).hide().fadeIn())}},function(at,av,au){aq.hide();alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var ar=M(this).parent().parent();var aq=M("#colorschema-ajax-loading").css({display:"inline"});N("delete_color_schema",{template:M("#mailster_template_name").val(),hash:ar.data("hash")},function(at){aq.hide();if(at.success){ar.fadeOut(100,function(){ar.remove()})}},function(at,av,au){aq.hide();alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var ar=M(".colorschema.custom");var aq=M("#colorschema-ajax-loading").css({display:"inline"});N("delete_color_schema_all",{template:M("#mailster_template_name").val()},function(at){aq.hide();if(at.success){ar.fadeOut(100,function(){ar.remove()})}},function(at,av,au){aq.hide();alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)})}return false}).on("change","#mailster_version",function(){var aq=M(this).val();G(aq)}).on("click","ul.backgrounds ul a",function(){M("ul.backgrounds").find("a").removeClass("active");var aq=M(this).parent().parent().data("base"),ar=M(this).addClass("active").data("file");if(!ar){aq=""}M("#mailster_background").val(aq+ar);X(aq+ar)}).on("mouseenter","ul.backgrounds a",function(){var ar=M(this).parent().parent().data("base"),aq=M(this).data("file");if(aq){M("ul.backgrounds a").eq(0).css({"background-image":"url("+ar+M(this).data("file")+")"})}}).on("mouseleave","ul.backgrounds a",function(){M("ul.backgrounds a").eq(0).css({"background-image":"url("+M.trim(M("#mailster_background").val())+")"})});w.on("click","a.addbutton",function(){var ar=M(this).data(),aq=ar.element.find("img").length?'<a href="" editable label="Button"><img alt=""></a>':'<a href="" editable label="Button"></a>';H.open({type:"btn",offset:ar.offset,element:M(aq).appendTo(ar.element),name:ar.name});return false}).on("click","a.addrepeater",function(){var aq=M(this).data();aq.element.clone().insertAfter(aq.element);v();return false}).on("click","a.removerepeater",function(){var aq=M(this).data();aq.element.remove();v();return false});M(".mailster-preview-iframe").on("load",function(){var av=M(this),ar=av.contents().find("body");if(av.is(".mobile")){var at=ar.find("style").text(),aq=/@media/.test(at);if(!aq){var au=0.85;ar.css({zoom:au,"-moz-transform":"scale("+au+")","-moz-transform-origin":"0 0",transform:"scale("+au+")","transform-origin":"0 0"})}}ar.on("click","a",function(){var aw=M(this).attr("href");if(aw&&aw!="#"){window.open(aw)}return false})});aa.on("click","a.button",function(){var aq=a.val();a.val(mailsterL10n.loading);N("get_plaintext",{html:g()},function(ar){a.val(ar)},function(ar,au,at){a.val(aq);alert(au+" "+ar.status+": "+at+"\n\n"+mailsterL10n.check_console)},"HTML")}).on("change","#plaintext",function(){var aq=M(this).is(":checked");a.prop("disabled",aq)[aq?"addClass":"removeClass"]("disabled")});if(typeof wp!="undefined"&&wp.heartbeat){M(document).on("heartbeat-send",function(ar,aq){if(aq.wp_autosave){aq.wp_autosave["content"]=g();aq.wp_autosave["excerpt"]=a.val();aq.mailsterdata=Q.serialize()}})}}else{R.prop("disabled",true);M("#change-permalinks").remove();if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}M("#show_recipients").on("click",function(){var at=M(this),ar=M("#recipients-list"),aq=M("#recipients-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css({display:"inline"});N("get_recipients",{id:S},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#show_clicks").on("click",function(){var at=M(this),ar=M("#clicks-list"),aq=M("#clicks-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css({display:"inline"});N("get_clicks",{id:S},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#show_environment").on("click",function(){var at=M(this),ar=M("#environment-list"),aq=M("#environment-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css({display:"inline"});N("get_environment",{id:S},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#show_geolocation").on("click",function(){var at=M(this),ar=M("#geolocation-list"),aq=M("#geolocation-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css({display:"inline"});N("get_geolocation",{id:S},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100,function(){var ay,az,aB={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ax;var aD;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aD=new google.visualization.GeoChart(document.getElementById("countries_map"));ay=az=google.visualization.arrayToDataTable(au.countrydata);if(location.hash&&(ax=location.hash.match(/region=([A-Z]{2})/))){av(ax[1])}else{aC()}google.visualization.events.addListener(aD,"regionClick",av)}});M("a.zoomout").on("click",function(){aw();return false});M("#countries_table").find("tbody").find("tr").on("click",function(){var aE=M(this).data("code");(aE=="unknown"||!aE)?aw():av(aE);return false});function aw(){var aE={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};ay=az;aC(aE);M("#countries_table").find("tr").removeClass("wp-ui-highlight");M("#mapinfo").hide();location.hash="#region="}function av(aF){var aE={},aG=aF.region?aF.region:aF,aH;if(aG.match(/-/)){return false}aE.region=aG;(au.unknown_cities[aG])?M("#mapinfo").show().html("+ "+au.unknown_cities[aG]+" unknown locations"):M("#mapinfo").hide();aH=au.geodata[aG]?au.geodata[aG]:[];aE.resolution="provinces";aE.displayMode="markers";aE.dataMode="markers";aE.colors=["#4EBEE9","#2BB3E7"];ay=new google.visualization.DataTable();ay.addColumn("number","Lat");ay.addColumn("number","Long");ay.addColumn("string","tooltip");ay.addColumn("number","Value");ay.addColumn({type:"string",role:"tooltip"});ay.addRows(aH);M("#countries_table").find("tr").removeClass("wp-ui-highlight");M("#country-row-"+aG).addClass("wp-ui-highlight");location.hash="#region="+aG;aC(aE)}function aC(aE){aE=M.extend(aB,aE);aD.draw(ay,aE);M("a.zoomout").css({visibility:(aB.region!="world"?"visible":"hidden")})}function aA(aF){var aE=aF;M.each(regions,function(aG,aH){if(M.inArray(aF,aH)!=-1){aE=aG}});return aE}})},function(au,aw,av){aq.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#show_errors").on("click",function(){var at=M(this),ar=M("#error-list"),aq=M("#error-ajax-loading");if(!ar.is(":hidden")){at.removeClass("open");ar.slideUp(100);return false}aq.css({display:"inline"});N("get_errors",{id:S},function(au){at.addClass("open");aq.hide();ar.html(au.html).slideDown(100)},function(au,aw,av){aq.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#show_countries").on("click",function(){M("#countries_wrap").toggle();return false});M("#mailster_details").on("click",".load-more-receivers",function(){var aw=M(this),av=aw.data("page"),at=aw.data("types"),au=aw.data("orderby"),ar=aw.data("order"),aq=aw.next().css({display:"inline"});N("get_recipients_page",{id:S,types:at,page:av,orderby:au,order:ar},function(ax){aq.hide();if(ax.success){aw.parent().parent().replaceWith(ax.html)}},function(ax,az,ay){detailbox.removeClass("loading");alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)});return false}).on("click",".recipients-limit",function(aq){if(aq.altKey){M("input.recipients-limit").prop("checked",false);M(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(au){var aw=M("#recipients-list"),ar=M("#recipients-ajax-loading"),at=M("input.recipients-limit:checked").map(function(){return this.value}).get(),av=M("select.recipients-order").val(),aq=M("a.recipients-order").hasClass("asc")?"ASC":"DESC";ar.css({display:"inline"});M("input.recipients-limit").prop("disabled",true);N("get_recipients",{id:S,types:at.join(","),orderby:av,order:aq},function(ax){ar.hide();M("input.recipients-limit").prop("disabled",false);aw.html(ax.html).slideDown(100)},function(ax,az,ay){ar.hide();alert(az+" "+ax.status+": "+ay+"\n\n"+mailsterL10n.check_console)});return false}).on("click","a.recipients-order",function(){M(this).toggleClass("asc");M("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var aq=M(this),at=aq.data("id"),ar=M("#receiver-detail-"+at).show();aq.parent().addClass("loading").parent().addClass("expanded");N("get_recipient_detail",{id:at,campaignid:S},function(au){aq.parent().removeClass("loading");if(au.success){ar.find("div.receiver-detail-body").html(au.html).slideDown(100)}},function(au,aw,av){ar.removeClass("loading");alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)});return false});M("#stats").on("click","label",function(){M("#recipients-list").find("input").prop("checked",false).filter("input."+M(this).attr("class")).prop("checked",true).trigger("change")});w.on("mouseenter","a.clickbadge",function(){var aw=M(this),aq=aw.position(),av=aw.data("p"),au=aw.data("link"),ar=aw.data("clicks"),at=aw.data("total");b.find(".piechart").data("easyPieChart").update(av);b.find(".link").html(au);b.find(".clicks").html(ar);b.find(".total").html(at);b.stop().fadeIn(100).css({top:aq.top-85,left:aq.left-(b.width()/2-aw.width()/2)})}).on("mouseleave","a.clickbadge",function(){b.stop().fadeOut(400)});M("#mailster_receivers").on("click",".create-new-list",function(){var aq=M(this).hide();M(".create-new-list-wrap").slideDown();M(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var au=M(this),at=M(".create-list-type"),ar="",aq=M("#mailster_total");if(at.val()==-1){return false}if(ar=prompt(mailsterL10n.enter_list_name,p(mailsterL10n.create_list,at.find(":selected").text(),M("#title").val()))){aq.addClass("loading");N("create_list",{name:ar,listtype:at.val(),id:S},function(av){aq.removeClass("loading");var aw=M('<div class="'+((!av.success)?"error":"updated")+'"><p>'+av.msg+"</p></div>").hide().prependTo(M(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})},function(av,ax,aw){aq.removeClass("loading");alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)})}return false}).on("change",".create-list-type",function(){var ar=M(this),aq=M("#mailster_total");if(ar.val()==-1){return false}ar.prop("disabled",true);aq.addClass("loading");N("get_create_list_count",{listtype:ar.val(),id:S},function(at){ar.prop("disabled",false);aq.removeClass("loading").html(at.count)},function(at,av,au){ar.prop("disabled",false);aq.removeClass("loading").html("");alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)})});M("#mailster_total").on("click",function(){M(".create-list-type").trigger("change")});M(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(aq){this.$el.find("span").text(Math.round(aq))},onStop:function(aq){this.$el.find("span").text(Math.round(aq))}});if(typeof wp!="undefined"&&wp.heartbeat){M(document).on("heartbeat-send",function(ar,aq){if(aq.wp_autosave){delete aq.wp_autosave}aq.mailster={page:"edit",id:S}}).on("heartbeat-tick",function(ax,av){if(!av.mailster[S]){return}var at=av.mailster[S],ar=M("#stats").find(".verybold"),au=M("#stats").find(".piechart"),aq=M(".progress"),aw=(at.sent/at.total*100);M(".hb-sent").html(at.sent_f);M(".hb-opens").html(at.opens_f);M(".hb-clicks").html(at.clicks_f);M(".hb-clicks_total").html(at.clicks_total_f);M(".hb-unsubs").html(at.unsubs_f);M(".hb-bounces").html(at.bounces_f);M(".hb-geo_location").html(at.geo_location);M.each(at.environment,function(ay){M(".hb-"+ay).html((this.percentage*100).toFixed(2)+"%")});au.eq(0).data("easyPieChart").update(Math.round(at.open_rate));au.eq(1).data("easyPieChart").update(Math.round(at.click_rate));au.eq(2).data("easyPieChart").update(Math.round(at.unsub_rate));au.eq(3).data("easyPieChart").update(Math.round(at.bounce_rate));aq.find(".bar").width(aw+"%");aq.find("span").eq(1).html(at.sent_formatted);aq.find("var").html(Math.round(aw)+"%");d(at.clickbadges);if(at.status!=M("#original_post_status").val()&&!M("#mailster_status_changed_info").length){M('<div id="mailster_status_changed_info" class="error inline"><p>'+p(mailsterL10n.statuschanged,'<a href="post.php?post='+S+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});wp.heartbeat.interval("fast")}}}var ae=function(){var aq,ar=w.offset();function aD(){q.on("click","a.template",aB).on("click","a.save-template",az).on("click","a.clear-modules",av).on("click","a.preview",ax).on("click","a.undo",aC).on("click","a.redo",ay).on("click","a.code",at).on("click","a.plaintext",au).on("click","a.dfw",ao);B.on("click","button.save-template",aA).on("click","button.save-template-cancel",tb_remove);ab.on("scroll.optionbar",function(){var aE=ab.scrollTop();if(aE<ar.top-50||aE>ar.top+w.height()-120){if(/fixed-optionbar/.test(B[0].className)){B.removeClass("fixed-optionbar")}q.width("auto")}else{if(!/fixed-optionbar/.test(B[0].className)){B.addClass("fixed-optionbar")}q.width(w.width())}}).on("resize.optionbar",function(){ar=w.offset();ab.trigger("scroll.optionbar")})}function az(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);M("#new_template_name").focus().select();return false}function aA(){F();var aH=M("#new_template_name").val();if(!aH){return false}u();var aE=M("#new_template-ajax-loading").css({display:"inline"}),aG=M("#new_template_modules").is(":checked"),aK=M("#new_template_active_modules").is(":checked"),aI=M("#new_template_saveas_dropdown").val(),aF=!!parseInt(M('input[name="new_template_overwrite"]:checked').val(),10),aJ=g();N("create_new_template",{name:aH,modules:aG,activemodules:aK,overwrite:aF?aI:false,template:M("#mailster_template_name").val(),content:aJ,head:m.val()},function(aL){aE.hide();if(aL.success){if(window.wp){window.wp=null}window.location=aL.url}else{alert(aL.msg)}},function(aL,aN,aM){aE.hide();alert(aN+" "+aL.status+": "+aM+"\n\n"+mailsterL10n.check_console)});return false}function aC(){if(ak){w.addClass("noeditbuttons");ak--;P(D[ak],100,false);T.val(D[ak]);q.find("a.redo").removeClass("disabled");if(!ak){M(this).addClass("disabled")}}return false}function ay(){var aE=D.length;if(ak<aE-1){w.addClass("noeditbuttons");ak++;P(D[ak],100,false);T.val(D[ak]);q.find("a.undo").removeClass("disabled");if(ak>=aE-1){M(this).addClass("disabled")}}return false}function av(){if(confirm(mailsterL10n.remove_all_modules)){w.addClass("noeditbuttons");var aE=y.contents().find("module");var aF=y.contents().find("modules");aF.slideUp(function(){aE.remove();aF.html("").show();v();u()})}return false}function ax(){var aH=M(this),aF=g(),aE=J.val(),aG=R.val();if(q.find("a.preview").is(".loading")){return false}q.find("a.preview").addClass("loading");N("set_preview",{id:S,content:aF,head:m.val(),issue:M("#mailster_autoresponder_issue").val(),subject:aE},function(aI){q.find("a.preview").removeClass("loading");M(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aI.hash+"&_wpnonce="+aI.nonce);tb_show((aG?p(mailsterL10n.preview_for,'"'+aG+'"'):mailsterL10n.preview),"#TB_inline?hash="+aI.hash+"&_wpnonce="+aI.nonce+"&width="+(Math.min(1200,ab.width()-50))+"&height="+(ab.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aI,aK,aJ){q.find("a.preview").removeClass("loading");alert(aK+" "+aI.status+": "+aJ+"\n\n"+mailsterL10n.check_console)})}function aw(){q.remove()}function ap(){M("#new_template_name").on("focus",function(){M(document).unbind("keypress.mailster").bind("keypress.mailster",function(aE){if(aE.keyCode==13){aA();return false}})}).select().focus().on("blur",function(){M(document).unbind("keypress.mailster")})}function aB(aE){var aF=M(this);aF.parent().find("ul").eq(0).slideToggle(100);return false}function at(){var aF=!y.is(":visible");if(!aF){q.find("a.code").addClass("loading");F();M.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){N("toggle_codeview",{content:g(),head:m.val(),_wpnonce:A},function(aG){q.find("a.code").addClass("active").removeClass("loading");I.hide();T.val(aG.content);q.find("a").not("a.redo, a.undo, a.code").addClass("disabled");w.addClass("noeditbuttons");aq=CodeMirror.fromTextArea(T.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true})},function(aG,aI,aH){q.find("a.code").addClass("active").removeClass("loading");x();alert(aI+" "+aG.status+": "+aH+"\n\n"+mailsterL10n.check_console)})})}else{var aE=aq.getValue();aq.clearHistory();P(aE,100,true);I.show();T.hide();M(".CodeMirror").remove();q.find("a.code").removeClass("active");q.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");w.removeClass("noeditbuttons");x();v()}return false}function au(){var aE=!y.is(":visible");if(!aE){q.find("a.plaintext").addClass("active");I.hide();a.show();aa.show();q.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled");w.addClass("noeditbuttons")}else{I.show();aa.hide();q.find("a.plaintext").removeClass("active");q.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");w.removeClass("noeditbuttons");v()}return false}function ao(aE){if(aE.type=="mouseout"&&!/DIV|H3/.test(aE.target.nodeName)){return}ar=w.offset();if(!B.hasClass("focus-on")){B.removeClass("focus-off").addClass("focus-on");M("#wpbody").on("mouseleave.dfw",ao);q.find("a.dfw").addClass("active");if(ab.scrollTop()<ar.top){c(ar.top-80)}}else{B.removeClass("focus-on").addClass("focus-off");M("#wpbody").off("mouseleave",ao);q.find("a.dfw").removeClass("active")}return false}aD();return{hide:function(){aw()}}};var an=function(){var be=M("#editbar"),aN,a5={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a4=be.find(".imagepreview"),aJ=be.find(".imagewidth"),aF=be.find(".imageheight"),bm=be.find(".factor"),a6=be.find(".highdpi"),aD=be.find(".imagelink"),bp=be.find(".imageurl"),bs=be.find(".orgimageurl"),av=be.find(".imagealt"),a7=be.find(".singlelink"),bo=be.find(".buttonlink"),aS=be.find(".buttonlabel"),aC=be.find(".buttonalt"),aI=be.find(".button-nav"),br=be.find("ul.buttons"),a9,aO,bg,bj,au,bf,aH,ay,aR,aB,az,aA="x",aq="",ar,ao=M("#wp-mailster-editor-wrap"),bc=M("#post-search"),at=M("#image-search");function bl(){be.on("keyup change","input.live",ap).on("keyup change","#mailster-editor",ap).on("click",".replace-image",a1).on("change",".highdpi",aW).on("click","button.save",aM).on("click",".cancel",ax).on("click","a.remove",aU).on("click","a.reload",bi).on("click","a.single-link-content",aQ).on("click","a.add_image",a0).on("click","a.add_image_url",aG).on("click",".imagelist li",aK).on("dblclick",".imagelist li",aM).on("change","#post_type_select input",bi).on("click",".postlist li",bb).on("click",".load-more-posts",bh).on("click","a.btnsrc",bq).on("click",".imagepreview",aL).on("click","a.nav-tab",aE).on("change","select.check-for-posts",aX).on("keyup change","#rss_url",bi).on("keyup change","#post-search",a3).on("keyup change","#image-search",a3).on("click","#rss_url",function(){M(this).focus().select()}).on("click",".rss_change",aw).on("click","#recent_feeds a",ba).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aV).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bk);ai(y.contents().find("img").eq(0),function(bu,bv,bw){var bt=bw>=1.5;bm.val(bw);a6.prop("checked",bt);(bt)?be.addClass("high-dpi"):be.removeClass("high-dpi")});aI.on("click","a",function(){M(this).parent().find("a").removeClass("nav-tab-active");M(this).parent().parent().find("ul.buttons").hide();var bt=M(this).addClass("nav-tab-active").attr("href");M("#tab-"+bt.substr(1)).show();return false});bp.on("paste change",function(bu){var bt=M(this);setTimeout(function(){var bw=a2(bt.val()),bv=new Image();if(bw){aP();bv.onload=function(){a4.attr("src",bw);bg={width:bv.width,height:bv.height,asp:bv.width/bv.height};aP(false)};bv.onerror=function(){if(bu.type!="paste"){alert(p(mailsterL10n.invalid_image,'"'+bw+'"'))}};bv.src=bw}},1)});aJ.on("change",function(){aF.val(Math.round(aJ.val()/bg.asp))});aF.on("change",function(){aJ.val(Math.round(aF.val()*bg.asp))});M("#dynamic_embed_options_post_type").on("change",function(){var bt=M("#dynamic_embed_options_cats");bt.find("select").prop("disabled",true);aP();N("get_post_term_dropdown",{posttype:M(this).val()},function(bu){aP(false);if(bu.success){bt.html(bu.html);if(au&&au.terms){var bv=bt.find(".dynamic_embed_options_taxonomy_wrap");M.each(au.terms,function(bx,bw){if(!bw){return}var by=bw.split(",");M.each(by,function(bA,bC){var bz=bv.eq(bx).find("select").eq(bA),bB;if(!bz.length){bB=bv.eq(bx).find("select").last();bz=bB.clone();bz.insertAfter(bB);M("<span> "+mailsterL10n.or+" </span>").insertBefore(bz)}bz.val(bC)})})}}aX()},function(bu,bw,bv){aP(false);alert(bw+" "+bu.status+": "+bv+"\n\n"+mailsterL10n.check_console)})});be.on("keypress.mailster",function(bt){if(bt.keyCode==13&&bt.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bt){switch(bt.keyCode){case 27:ax();return false;break;case 13:if(aO.type!="multi"&&aO.type!="codeview"){aM();return false}break}});be.find(".current-tag").on("click","a",function(){return false});if(be.draggable){be.draggable({distance:20,axis:"y"})}if(i&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){aZ(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){aZ(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){aZ(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){aZ(this)})}}}function bn(bt){if(be.draggable){if(bt!==false){be.draggable("enable")}else{be.draggable("disable")}}}function aV(){bn(false)}function bk(){bn(true)}function aE(bv,bt){var bu;if(typeof bv=="string"){bu=aN.find('a[href="'+bv+'"]')}else{bu=M(this);bv=bu.attr("href")}bu.parent().find("a.nav-tab").removeClass("nav-tab-active");bu.addClass("nav-tab-active");aN.find(".tab").hide();aN.find(bv).show();if(bv=="#dynamic_embed_options"&&bt!==false){M("#dynamic_embed_options_post_type").trigger("change")}if(bv=="#image_button"){a9="image"}if(bv=="#text_button"){a9="text"}aH=aN.find(bv).find(".postlist").eq(0);return false}function a1(){aP();var bw=bm.val(),bt=aO.element.width(),bv=Math.round(bt/1.6),bu=M("<img>",{src:"https://dummy.newsletter-plugin.com/"+(bt*bw)+"x"+(bv*bw)+".jpg",alt:aO.content,title:aO.content,label:aO.content,width:bt,height:bv,border:0,editable:aO.content});bu[0].onload=function(){bu.attr({width:bt,height:bv}).removeAttr("style");bd()};if(aO.element.parent().is("a")){aO.element.unwrap()}if(!aO.element.parent().is("td")){aO.element.unwrap()}aO.element.replaceWith(bu);return false}function aW(){if(M(this).is(":checked")){bm.val(2);be.addClass("high-dpi")}else{bm.val(1);be.removeClass("high-dpi")}}function aX(){clearInterval(aR);aP();M("#dynamic_embed_options").find("h4.current-match").html("&hellip;");M("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aR=setTimeout(function(){var bx=be.find("#dynamic_embed_options_post_type").val(),bu=be.find("#dynamic_embed_options_content").val(),bw=be.find("#dynamic_embed_options_relative").val(),bv=be.find(".dynamic_embed_options_taxonomy_wrap"),bt=[];M.each(bv,function(bA){var bz=M(this).find("select"),by=[];M.each(bz,function(){var bB=parseInt(M(this).val(),10);if(bB!=-1&&M.inArray(bB,by)==-1&&!isNaN(bB)){by.push(bB)}});by=by.join(",");if(by){bt[bA]=by}});N("check_for_posts",{post_type:bx,relative:bw,extra:bt},function(by){aP(false);if(by.success){bj=by.pattern;M("#dynamic_embed_options").find("h4.current-match").html(by.title);M("#dynamic_embed_options").find("div.current-tag").text(by.pattern.title+"\n\n"+by.pattern[bu])}},function(by,bA,bz){aP(false);alert(bA+" "+by.status+": "+bz+"\n\n"+mailsterL10n.check_console)})},500);return false}function a2(bx,bu,bv){var bt;if(/^\{([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?\}$/.test(bx)){var bw=bm.val();bx=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+bx.replace("{","").replace("}","")+"&w="+((bu||aJ.val())*bw)+"&h="+((bv||aF.val())*bw)+"&f="+bw}return bx}function aY(bu){if(-1!==bu.indexOf("?action=mailster_image_placeholder&tag=")){var bt=bu.match(/([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?/);return"{"+bt[0]+"}"}return false}function ap(bt){if((bt.keyCode||bt.which)!=27&&aO){aO.element.html(M(this).val())}}function aP(bt){if(bt===false){M("#editbar-ajax-loading").hide();be.find(".buttons").find("button").prop("disabled",false)}else{M("#editbar-ajax-loading").css({display:"inline"});be.find(".buttons").find("button").prop("disabled",true)}}function aM(){if(aO.type=="img"){var bJ=aO.element.is("img");if(bp.val()){bg={id:null,name:"",src:a2(bp.val()),width:bg.width,height:bg.height,asp:bg.width/bg.height}}if(bg){aP();var bF=bm.val()||1,bA=bJ?"src":"background";aO.element.attr({"data-id":bg.id}).data("id",bg.id).addClass("mailster-loading");if(bJ){aO.element.attr({width:Math.round(aJ.val()),height:Math.round(aF.val()),alt:bg.name})}if(bg.src){aO.element.attr(bA,bg.src);aO.element[0].style.cssText=aO.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bg.src+")")}N("create_image",{id:bg.id,src:bg.src,width:aJ.val()*bF,height:aF.val()*bF},function(bL){aP(false);if(bL.success){a4.attr("src",bL.image.url);bL.image.width=(bL.image.width||bg.width)/bF;bL.image.height=bL.image.width/(bg.asp);bL.image.asp=bg.asp;bg=bL.image;bg.name=av.val();if(bJ){aO.element.one("load",function(){aO.element.removeClass("mailster-loading");u()});aO.element.attr({width:Math.round(aJ.val()),height:Math.round(aF.val()),alt:bg.name})}else{aO.element.removeClass("mailster-loading");var bM=aO.element.html();aO.element.html(aj(bM,bs.val(),bg.url))}aO.element.removeAttr(bA).attr(bA,bg.url)}else{aO.element.removeClass("mailster-loading")}av.val("");bd()},function(bL,bN,bM){aP(false);alert(bN+" "+bL.status+": "+bM+"\n\n"+mailsterL10n.check_console)})}else{aO.element.attr({alt:av.val()});bd()}if(aO.element.parent().is("a")){aO.element.unwrap()}var bw=aD.val();if(bw){aO.element.wrap('<a href="'+bw+'"></a>')}return false}else{if(aO.type=="btn"){var bw=bo.val();if(!bw&&!confirm(mailsterL10n.remove_btn)){return false}var bv=aN.find("a.active").find("img").attr("src");if(typeof bv=="undefined"){a9="text";if(!aS.val()){aS.val(mailsterL10n.read_more)}}if("image"==a9){var bF=bm.val();var bK=new Image();bK.onload=function(){if(!aO.element.find("img").length){var bM=aO.element.closest("table.textbutton");var bL=M('<a href="" editable label="'+aO.name+'"><img></a>');(bM.length)?bM.replaceWith(bL):aO.element.replaceWith(bL);aO.element=bL}aO.element.find("img").attr({src:bv,width:Math.round((bK.width||aO.element.width())/bF),height:Math.round((bK.height||aO.element.height())/bF),alt:aC.val(),title:aC.val()});(bw)?aO.element.attr("href",bw):aO.element.remove();bd()};bK.src=bv}else{var by=aO.element.closest("table.textbutton"),bx=aS.val();if(!by.length){aO.element.replaceWith('<table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bw+'" editable label="'+bx+'">'+bx+"</a></td></tr></table>")}else{aO.element.text(bx)}if(bw){aO.element.attr("href",bw)}else{aO.element.remove();by.remove()}bd()}return false}else{if(aO.type=="auto"){var bG=M("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bG){var bB=be.find("#dynamic_embed_options_content").val();bj.content=bj[bB];aO.element.attr("data-tag",bj.tag).data("tag",bj.tag)}else{if("rss"==bG){var bB=M(".embed_options_content_rss:checked").val();aO.element.removeAttr("data-tag").removeData("tag")}else{var bB=M(".embed_options_content:checked").val();aO.element.removeAttr("data-tag").removeData("tag")}}if(bj){aO.elements.headlines.html("");if(bj.title){aO.elements.headlines.eq(0).html(bj.title)}if(bj.link){if(aO.elements.buttons.length){aO.elements.buttons.last().attr("href",bj.link);aO.elements.buttons.not(":last").remove()}else{aO.elements.bodies.last().after('<buttons><table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bj.link+'" title="'+mailsterL10n.read_more+'" editable label="'+mailsterL10n.read_more+'">'+mailsterL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aO.elements.buttons.parent().length&&aO.elements.buttons.parent()[0].nodeName=="TD"){aO.elements.buttons.closest("table.textbutton").remove()}else{if(aO.elements.buttons.length){if(aO.elements.buttons.last().find("img").length){aO.elements.buttons.remove()}}}}if(aO.elements.bodies.length){var bt=aO.elements.bodies.length,bD=bj[bB]?bj[bB]:"",bH=bD.length,bu=("static"==bG)?Math.ceil(bH/bt):bH;for(var bE=0;bE<bt;bE++){aO.elements.bodies.eq(bE).html(bD.substring(bE*bu,bE*bu+bu))}}if(bj.image&&aO.elements.images.length){aP();var bI=aO.elements.images.eq(0);var bF=bm.val();if("static"==bG){N("create_image",{id:bj.image.id,width:aO.elements.images.eq(0).width()*bF},function(bL){if(bL.success){aP(false);bI.attr({"data-id":bj.image.id,src:bL.image.url,width:Math.round(bL.image.width/bF),height:Math.round(bL.image.height/bF),alt:bj.alt||bj.title}).data("id",bj.image.id);if(bI.parent().is("a")){bI.unwrap()}if(bj.link){bI.wrap("<a>");bI.parent().attr("href",bj.link)}}bd()},function(bL,bN,bM){aP(false);alert(bN+" "+bL.status+": "+bM+"\n\n"+mailsterL10n.check_console)});return false}else{if("rss"==bG){var bC=bI.width();bI.removeAttr("height").removeAttr("data-id").attr({src:a2(bj.image.src,bC),width:bC,alt:bj.alt||bj.title}).removeData("id")}else{var bC=bI.width();bI.removeAttr("height").removeAttr("data-id").attr({src:a2(bj.image,bC),width:bC,alt:bj.alt||bj.title}).removeData("id")}}}y.contents().find("html").find("img").each(function(){this.onload=function(){v()}})}}else{if(aO.type=="multi"){if(i&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){aO.element.html(tinymce.get("mailster-editor").getContent())}}else{if(aO.type=="single"){if(aO.conditions){aO.aa="<if";M.each(M(".conditinal-area"),function(){aO.aa=""})}if(aO.element.parent().is("a")){aO.element.unwrap()}var bw=a7.val();if(bw){aO.element.wrap('<a href="'+bw+'"></a>')}}else{if(aO.type=="codeview"){var bz=ar.getValue();aO.element.html(al(bz));aO.modulebuttons.prependTo(aO.element)}}}}}}bd();return false}function aU(){if(aO.element.parent().is("a")){aO.element.unwrap()}if(!aO.element.parent().is("td")){aO.element.unwrap()}if("btn"==aO.type){var bt=aO.element.closest("table.textbutton");if(bt.length){bt.remove()}}aO.element.remove();bd();return false}function ax(){switch(aO.type){case"img":break;case"btn":if(!aO.element.attr("href")){var bt=aO.element.closest("table.textbutton");if(bt.length){bt.remove()}aO.element.remove()}break;default:aO.element.html(aO.content)}bd();return false}function bq(){var bv=M(this),bt=bv.data("link");aN.find(".btnsrc").removeClass("active");bv.addClass("active");aC.val(bv.attr("title"));if(bt){var bu;bo.val(bt);if((bu=(bt+"").indexOf("USERNAME",0))!=-1){bo.focus();j(bo[0],bu,bu+8)}}return false}function aL(){M(this).toggleClass("zoom")}function aK(bv,bu){var by=bu||M(this),bx=by.data("id"),bt=by.data("name"),bw=by.data("src");bg={id:bx,name:bt,src:bw};aP();aN.find("li.selected").removeClass("selected");by.addClass("selected");if(aO.element.data("id")==bx){av.val(aO.element.attr("alt"))}else{if(aO.element.attr("alt")!=bt){av.val(bt)}}bp.val("");a4.attr("src","").on("load",function(){a4.off("load");aO.width=a4.width();aO.height=a4.height();aO.asp=by.data("asp")||(aO.width/aO.height);bg.asp=aO.asp;aP(false);aF.val(Math.round(aJ.val()/aO.asp))}).attr("src",bw);return bg}function bb(){var bx=M(this),bw=bx.data("id"),bt=bx.data("name"),bu=bx.data("link"),bv=bx.data("thumbid");if(aO.type=="btn"){bo.val(bu);aC.val(bt);aN.find("li.selected").removeClass("selected");bx.addClass("selected")}else{if(aO.type=="single"){a7.val(bu);aN.find("li.selected").removeClass("selected");bx.addClass("selected")}else{aP();N("get_post",{id:bw},function(by){aP(false);aN.find("li.selected").removeClass("selected");bx.addClass("selected");if(by.success){bj={title:by.title,alt:by.alt,link:by.link,content:by.content,excerpt:by.excerpt,image:by.image?{id:by.image.id,src:by.image.src,name:by.image.name}:false};aN.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bj.title+"</span>")}},function(by,bA,bz){aP(false);aN.find("li.selected").removeClass("selected");alert(bA+" "+by.status+": "+bz+"\n\n"+mailsterL10n.check_console)})}}return false}function aT(bN){aO=bN;var bu=bN.element,bF=(bw!="img")?bN.offset.top:0,bO=bN.name||"",bw=bN.type,bH=M.trim(bu.html()),bI=bu.find("if"),bA,bM,bD,by,bB=1;aN=be.find("div.type."+bw);be.addClass("current-"+bw);aO.width=bu.width();aO.height=bu.height();aO.asp=aO.width/aO.height;aO.content=bH;au=aO.element.data("tag");if(bI.length){bA={"if":null,elseif:[],"else":null,total:0};bA=[];be.addClass("has-conditions");bM=aN.find(".conditinal-area");bD=be.find(".conditions").eq(0);bD.clone().prependTo(bM);M.each(bI.find("elseif"),function(){var bQ=M(this),bP=bQ.html();bA.push({el:bQ,html:bP,field:bQ.attr("field"),operator:bQ.attr("operator"),value:bQ.attr("value")});bQ.detach();bM.clone().val(bP).insertAfter(bM)});M.each(bI.find("else"),function(){var bQ=M(this),bP=bQ.html();bA.push({el:bQ,html:bP});bQ.detach();bM.clone().val(bP).insertAfter(bM)});bA.unshift({el:bI,html:bI.html(),field:bI.attr("field"),operator:bI.attr("operator"),value:bI.attr("value")})}else{be.removeClass("has-conditions")}aO.conditions=bA;if(bw=="img"){bm.val(1);ai(bu,function(bP,bQ,bR){var bQ=bR>=1.5;bm.val(bR);a6.prop("checked",bQ);(bQ)?be.addClass("high-dpi"):be.removeClass("high-dpi");bB=bR})}else{if(bw=="btn"){if(bu.find("img").length){M("#button-type-bar").find("a").eq(1).trigger("click");var bx=bu.find("img").attr("src");if(aI.length){var bt=be.find("img[src='"+bx+"']");if(bt.length){be.find("ul.buttons").hide();var bL=bt.parent().parent().parent();be.find('a[href="#'+bL.attr("id").substr(4)+'"]').trigger("click")}else{M.each(be.find(".button-nav"),function(){M(this).find(".nav-tab").eq(0).trigger("click")})}}aS.val(bu.find("img").attr("alt"));ai(bu.find("img"),function(bP,bQ,bR){var bQ=bR>=1.5;bm.val(bR);a6.prop("checked",bQ);(bQ)?be.addClass("high-dpi"):be.removeClass("high-dpi");bB=bR})}else{M("#button-type-bar").find("a").eq(0).trigger("click");aS.val(M.trim(bu.text())).focus().select();be.find("ul.buttons").hide()}}else{if(bw=="auto"){aE("#"+(au?"dynamic":"static")+"_embed_options",true);if(au){var bG=au.substr(1,au.length-2).split(":"),bv=bG[1].split(";"),bK=parseInt(bv.shift(),10),bz=bv.length?bv:null;au={post_type:bG[0],relative:bK,terms:bz};M("#dynamic_embed_options_post_type").val(au.post_type).trigger("change");M("#dynamic_embed_options_relative").val(au.relative).trigger("change")}else{}}else{if(bw=="codeview"){var bE=aN.find("textarea"),bJ=bu.clone();aO.modulebuttons=bJ.find(".modulebuttons");bJ.find(".modulebuttons").remove();var bC=M.trim(bJ.html());bE.html(bC);M.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){})}}}}w.addClass("noeditbuttons");by=w.offset().top+(aO.offset.top-(ab.height()/2)+(aO.height/2));by=Math.max(w.offset().top-200,by);c(by,function(){be.find("h4.editbar-title").html(bO);be.find("div.type").hide();be.find("div."+bw).show();var bT=ac.scrollTop()+(ab.height()/2)-w.offset().top-(be.height()/2);be.css({top:bT});aP();if(bw=="single"){if(bA){M.each(bA,function(bY,bZ){var bX=aN.find(".conditinal-area").eq(bY);bX.find("select.condition-fields").val(bZ.field);bX.find("select.condition-operators").val(bZ.operator);bX.find("input.condition-value").val(bZ.value);bX.find("input.input").val(bZ.html)})}else{var bW=bH.replace(/&amp;/g,"&");if(aO.element.parent().is("a")){var bQ=aO.element.parent().attr("href");a7.val(bQ!="#"?bQ:"")}else{if(aO.element.find("a").length){var bS=aO.element.find("a");if(bW==bS.text()){var bQ=bS.attr("href");bW=bS.text();a7.val(bQ!="#"?bQ:"")}}}aN.find("input").eq(0).val(M.trim(bW))}}else{if(bw=="img"){var bP=parseInt(bu[0].style.maxWidth,10)||bu.parent().width()||bu.width()||null;var bV=parseInt(bu[0].style.maxHeight,10)||bu.parent().height()||bu.height()||null;var bU=bu.attr("src")||bu.attr("background");var bR=aY(bU)||"";if(bu.parent().is("a")){aD.val(bu.parent().attr("href").replace("%7B","{").replace("%7D","}"))}av.val(bu.attr("alt"));bp.val(bR);bs.val(bU);bu.data("id",bu.attr("data-id"));M(".imageurl-popup").toggle(!!bR);a4.removeAttr("src").attr("src",bU);bf="attachment";aH=aN.find(".imagelist");bg={id:bu.data("id"),width:bu.width()*bB,height:bu.height()*bB};bg.asp=bg.width/bg.height;bi()}else{if(bw=="btn"){aC.val(bu.find("img").attr("alt"));if(bu.attr("href")){bo.val(bu.attr("href").replace("%7B","{").replace("%7D","}"))}bf="link";aH=aN.find(".postlist").eq(0);bi();M.each(aN.find(".buttons img"),function(){var bX=M(this);bX.css("background-color",bu.css("background-color"));(bX.attr("src")==bx)?bX.parent().addClass("active"):bX.parent().removeClass("active")})}else{if(bw=="auto"){bf="post";aH=aN.find(".postlist").eq(0);bi();aO.elements={headlines:aO.element.find("single"),bodies:aO.element.find("multi"),buttons:aO.element.find("a[editable]"),images:aO.element.find("img[editable]")}}else{if(bw=="codeview"){M.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){if(ar){ar.clearHistory()}ar=ar||CodeMirror.fromTextArea(bE.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true});ar.setValue(bC)})}}}}}be.show(0,function(){if(bw=="single"){be.find("input").focus().select()}else{if(bw=="img"){aJ.val(aO.width);aF.val(aO.height)}else{if(bw=="btn"){aJ.val(bP);aF.val(bV)}else{if(bw=="multi"){M("#mailster-editor").val(bH);if(i&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bH);tinymce.execCommand("mceFocus",false,"mailster-editor")}}}}}});aP(false)},Math.abs(by-ac.scrollTop()))}function bi(bt,bw){var bv=M("#post_type_select").find("input:checked").serialize(),bu={type:bf,posttypes:bv,search:aq,offset:0};if(M(this).is("#rss_url")){bu.type="_rss";bu.url=M.trim(M("#rss_url").val());if(bu.url==aA){return false}aA=bu.url;if(!bu.url){M("#rss_more").slideUp(200);return false}M(".rss_info").html("")}if(bf=="attachment"){bu.id=bg.id}aH.empty();aP();N("get_post_list",bu,function(bx){aP(false);if(bx.success){ay=bx.itemcount;a8(bx.html,true);aH.find(".selected").trigger("click");if(bx.rssinfo){M("#rss_more").slideDown(200);M("#rss_input").slideUp(200);M(".rss_info").html("<h4>"+bx.rssinfo.title+" &ndash; "+bx.rssinfo.description+'</h4><p class="tiny">'+bx.rssinfo.copyright+"</p>")}bw&&bw()}},function(bx,bz,by){aP(false);alert(bz+" "+bx.status+": "+by+"\n\n"+mailsterL10n.check_console)})}function bh(){var bv=M(this),bw=bv.data("offset"),bt=bv.data("type");aP();var bu=M("#post_type_select").find("input:checked").serialize();N("get_post_list",{type:bt,posttypes:bu,search:aq,offset:bw,url:M.trim(M("#rss_url").val()),itemcount:ay},function(bx){aP(false);if(bx.success){ay=bx.itemcount;bv.parent().remove();a8(bx.html,false)}},function(bx,bz,by){aP(false);alert(bz+" "+bx.status+": "+by+"\n\n"+mailsterL10n.check_console)});return false}function a3(){var bt=M(this);clearTimeout(aB);aB=setTimeout(function(){var bu=bt.val();if(bu==aq){return}aq=bu;bi()},300)}function aQ(){M("#single-link").slideDown(200);a7.focus().select();bf="link";aH=aN.find(".postlist").eq(0);bi();return false}function a8(bu,bt,bv){if(!bv){bv=aH}if(bt){bv.empty()}if(!bv.html()){bv.html("<ul></ul>")}bv.find("ul").append(bu)}function ba(){M("#rss_url").val(M(this).attr("href")).trigger("change");return false}function aw(){M("#rss_url").val("");M("#rss_more").slideUp(200);M("#rss_input").slideDown(200);return false}function aG(){M(".imageurl-popup").toggle();bp.focus().select();return false}function a0(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var bu=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bt=M("img").data({id:bu.id,name:bu.name,src:bu.url});bi(null,function(){aK(null,bt)})})}wp.media.frames.mailster_editbar.open()}function aZ(bt){clearTimeout(af);af=setTimeout(function(){if(!bt){return}var bu=M.trim(bt.save());aO.element.html(bu)},100)}function bd(){be.removeClass("current-"+aO.type).hide();aP(false);M("#single-link").hide();u();v();return false}bl();return{open:function(bt){aT(bt)},close:function(){bd()}}};var am=function(){var av=M("#mailster_template"),aF=M("#module-selector"),aE=M("a.toggle-modules"),aB=y.contents().find("modules"),az=y.contents().find("body"),aH=aB.find("module"),aC,ar={},aD=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function au(){var aK=aF.data("current");ap(M(this).data("id"),((aK&&aK.is("module"))?aK:false),true);return false}function ax(){var aK=M(this).parent().parent().parent();aK.insertBefore(aK.prev("module"));v();u();return false}function ay(){var aK=M(this).parent().parent().parent();aK.insertAfter(aK.next("module"));v();u();return false}function aq(){var aK=M(this).parent().parent().parent(),aM=aK.clone().hide();w.addClass("noeditbuttons");aM.insertAfter(aK);K(0,0);aM.slideDown(function(){aM.css("display","block");v();u()});var aL=aM.offset().top+w.offset().top-(ab.height()/2)-aM.outerHeight();aL=Math.max(w.offset().top,aL);c(aL);return false}function aw(){var aK=M(this).parent().parent().parent();var aL={element:aK,name:aK.attr("label"),type:"auto",offset:aK.offset()};H.open(aL);return false}function aA(){var aM=M(this),aL=aM.val(),aK=aM.parent().parent();if(!aL){aL=aM.attr("placeholder");aM.val(aL)}aK.attr("label",aL)}function aJ(){var aK=M(this).parent().parent().parent();aK.fadeTo(100,0,function(){w.addClass("noeditbuttons");aK.slideUp(200,function(){aK.remove();aH=y.contents().find("module");if(!aH.length){aB.html("")}v();u()})});return false}function ap(aP,aK,aL,aM){if(!ar[aP]){return false}var aO=ar[aP].el.clone();w.addClass("noeditbuttons");(aK)?(aL?aO.hide().insertBefore(aK):aO.hide().insertAfter(aK)):aO.hide().appendTo(aB);K(0,0);aO.slideDown(200,function(){aO.addClass("active").css("display","block");v();u()});if(!aM){var aN=aO.offset().top+w.offset().top-(ab.height()/2)-aO.outerHeight();aN=Math.max(w.offset().top,aN);c(aN)}}function ao(){var aK=M(this).parent().parent().parent();var aL={element:aK,name:aK.attr("label"),type:"codeview",offset:aK.offset()};H.open(aL);return false}function aI(){U.toggleClass("show-modules");aD=!aD;window.setUserSetting("mailstershowmodules",aD?1:0);v()}function aG(){w.on("click","a.toggle-modules",aI).on("click","a.addmodule",au);at()}function at(){aH=y.contents().find("module");if(!aH.length){aB.html("")}aC=M(Y.val()).add(aH);if(!aC.length){aF.remove();return}aB=y.contents().find("modules");aB.on("click","a.up",ax).on("click","a.down",ay).on("click","a.auto",aw).on("click","a.duplicate",aq).on("click","a.remove",aJ).on("click","a.codeview",ao).on("change","input.modulelabel",aA);var aO="",aK="",aN=0;ar=[];M.each(aC,function(aT){var aV=M(this);if(aV.is("module")){var aS=aV.attr("label"),aU=mailsterdata.codeview?'<a class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></a>':"",aW=(aV.is("[auto]")?'<a class="mailster-btn auto" title="'+mailsterL10n.auto+'"></a>':"");M('<div class="modulebuttons '+(mailsterdata.isrtl?"modulebuttons-rtl":"")+'"><span>'+aW+'<a class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></a><a class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></a><a class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></a>'+aU+'<a class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aS+'" placeholder="'+aS+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></div>').prependTo(aV);if(!aV.parent().length){ar.push({name:aS,el:aV})}}});var aQ,aM,aL=M("<dropzone></dropzone>"),aR=aL.clone(),aP=aL.add(aR);if(!M._data(aF[0],"events")){aF.on("dragstart.mailster","li",function(aS){window.mailster_is_modulde_dragging=true;aS.originalEvent.dataTransfer.setData("Text",this.id);w.addClass("noeditbuttons");az.addClass("drag-active");aM=M(aS.target).data("id");aB.on("dragenter.mailster",function(aT){var aU=M(aT.target).closest("module");if(!aU.length||aQ&&aQ[0]===aU[0]){return}aQ=aU;aR.appendTo(aQ);aL.prependTo(aQ);setTimeout(function(){aR.addClass("visible");aL.addClass("visible");aH.removeClass("drag-up drag-down");aU.prevAll("module").addClass("drag-up");aU.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(aT){aT.preventDefault()}).on("drop.mailster",function(aT){ap(aM,aH.length?(aQ&&aQ[0]===aB?false:aQ):false,aL[0]===aT.target,true);aH=y.contents().find("module");aT.preventDefault()});aP.on("dragenter.mailster",function(aT){M(this).addClass("drag-over")}).on("dragleave.mailster",function(aT){M(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aS){aQ=null;az.removeClass("drag-active");aP.removeClass("visible drag-over").remove();aH.removeClass("drag-up drag-down");aB.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aP.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}v()}aG();return{refresh:function(){at()}}};function c(aq,ap,ao){if(isNaN(ao)){ao=400}if(ac.scrollTop()==aq){ap&&ap();return}ac.animate({scrollTop:aq},ao,ap&&function(){ap()})}function v(){clearTimeout(z);z=setTimeout(function(){K();if(!e){if(y[0].contentWindow.window.mailster_refresh){y[0].contentWindow.window.mailster_refresh()}o()}else{d()}},10)}function K(ao,ap){if(!C){return false}setTimeout(function(){if(!y[0].contentWindow.document.body){return}var aq=y[0].contentWindow.document.body.offsetHeight||y.contents().find("html")[0].innerHeight||y.contents().find("html").height();y.attr("height",Math.max(500,aq+10+(ao||0)))},ap?ap:500)}function u(){if(!e&&C){var aq=t();var ap=D.length,ao=D[ap];if(ao!=aq){T.val(aq);W.prop("readonly",!aq.match("{preheader}"));D=D.splice(0,ak+1);D.push(m.val()+aq);if(ap>=mailsterL10n.undosteps){D.shift()}ak=D.length-1;if(ak){q.find("a.undo").removeClass("disabled")}q.find("a.redo").addClass("disabled")}}}function o(){w.find(".content.mailster-btn").remove();var ao=y.contents().find("html");var aq=ao.find("buttons"),ap=ao.find("[repeatable]");if(!ao){return}setTimeout(function(){if(!M._data(ao[0],"events")){ao.off(".mailster").on("click.mailster","multi, single",function(au){au.stopPropagation();var ax=M(this),ay=ax.offset(),aw=ay.top+40,av=ay.left,ar=ax.attr("label"),at=ax.prop("tagName").toLowerCase();H.open({offset:ay,type:at,name:ar,element:ax})}).on("click.mailster","img[editable]",function(au){au.stopPropagation();var ax=M(this),ay=ax.offset(),aw=ay.top+61,av=ay.left,ar=ax.attr("label"),at="img";H.open({offset:ay,type:at,name:ar,element:ax})}).on("click.mailster","td[background]",function(au){au.stopPropagation();if(au.target.tagName.toLowerCase()=="module"||this==ao.find("table").eq(0).find("td")[0]){return}var ax=M(this),ay=ax.offset(),aw=ay.top+61,av=ay.left,ar=ax.attr("label"),at="img";H.open({offset:ay,type:at,name:ar,element:ax})}).on("click.mailster","a[editable]",function(au){au.stopPropagation();au.preventDefault();var ax=M(this),ay=ax.offset(),aw=ay.top+40,av=ay.left,ar=ax.attr("label"),at="btn";H.open({offset:ay,type:at,name:ar,element:ax})})}M.each(aq,function(){var aw=M(this),ar=aw.attr("label"),ax=this.getBoundingClientRect(),av=ax.top+46,au=ax.right+16,at;at=M('<a class="addbutton content mailster-btn" title="'+mailsterL10n.add_button+'"></a>').css({top:av,left:au}).appendTo(w);at.data("offset",ax).data("name",ar);at.data("element",aw)});M.each(ap,function(){var aw=M(this),ar=aw.attr("label"),ax=this.getBoundingClientRect(),av=ax.top+48,au=ax.right,at;at=M('<a class="addrepeater content mailster-btn" title="'+p(mailsterL10n.add_s,ar)+'"></a>').css({top:av-3,left:au+18}).appendTo(w);at.data("offset",ax).data("name",ar);at.data("element",aw);at=M('<a class="removerepeater content mailster-btn" title="'+p(mailsterL10n.remove_s,ar)+'"></a>').css({top:av+18,left:au+18}).appendTo(w);at.data("offset",ax).data("name",ar);at.data("element",aw)});w.removeClass("noeditbuttons")},500)}function d(ao){w.find(".clickbadge").remove();var ao=ao||M("#mailster_click_stats").data("stats"),ap=parseInt(ao.total,10);if(!ap){return}M.each(ao.clicks,function(ar,aq){M.each(aq,function(av,az){var ay=y.contents().find('a[href="'+ar.replace("&amp;","&")+'"]').eq(av);if(ay.length){ay.css({display:"inline-block"});var au=ay.offset(),ax=au.top,at=au.left+5,aB=(az.clicks/ap)*100,aA=(aB<1?"&lsaquo;1":Math.round(aB))+"%",aw=M('<a class="clickbadge '+(aB<40?"clickbadge-outside":"")+'" data-p="'+aB+'" data-link="'+ar+'" data-clicks="'+az.clicks+'" data-total="'+az.total+'"><span style="width:'+(Math.max(0,aB-2))+'%">'+(aB<40?"&nbsp;":aA)+"</span>"+(aB<40?" "+aA:"")+"</a>").css({top:ax,left:at}).appendTo(w)}})})}function L(au,at,aq){if(!au){au=at}if(!at){return false}if(au==at){return false}var ap=g(),ar=new RegExp(au,"gi"),ao=Y.val();if(aq){aq.data("value",at)}Y.val(ao.replace(ar,at));M("#mailster-color-"+au.substr(1).toLowerCase()).attr("id","mailster-color-"+at.substr(1).toLowerCase());P(ap.replace(ar,at),3000)}function aj(aq,ao,ap){if(ao===ap){return aq}do{aq=aq.replace(ao,ap)}while(aq.indexOf(ao)!==-1);return aq}function X(aq){var ao=g(),ap=ao.replace(/body{background-image:url\(.*}/i,"");if(aq){var ar=(aq)?"\tbody{background-image:url('"+aq+"');background-repeat:repeat-y no-repeat;background-position:top center;}":"",ap=ap.replace(/<style.*?>/i,'<style type="text/css">'+ar).replace(/<td/i,'<td background="'+aq+'"');M("ul.backgrounds > li > a").css({"background-image":"url('"+aq+"')"})}else{var at=ap.match(/<td(.*)background="[^"]*"(.*)/i);if(at){ap=ap.replace(at[0],"<td "+at[1]+" "+at[2])}M("ul.backgrounds > li > a").css({"background-image":"none"})}P(ap);return}function G(ap){var aq=g(),ar=/\/img\/version(\d+)\//g,at="/img/"+ap+"/";html=aq.replace(ar,at);var ao=Y.val();Y.val(ao.replace(ar,at));P(html);return}function F(ao){ah=true;M("#publishing-action").find("input").prop("disabled",true);M(".button").prop("disabled",true);if(ao!==true){M("input").prop("disabled",true)}}function x(){M("#publishing-action").find("input").prop("disabled",false);M(".button").prop("disabled",false);M("input").prop("disabled",false);ah=false}function t(){var ao=y[0].contentWindow.document.body;if(typeof ao=="null"||!ao){return""}var ar=M.trim(ao.innerHTML);var at=ao.attributes,ap=at.length,aq="";while(ap--){aq=" "+at[ap].name+'="'+at[ap].value+'"'+aq}aq=aq.replace("position: relative;","").replace(' class=""',"").replace(' style=""',"");return m.val()+"\n<body"+aq+">\n"+ar+"\n</body>\n</html>"}function g(){return T.val()||t()}function P(at,aq,ar){var ap=at.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m),at=ap?ap[3]:"<multi>"+at+"</multi>",av=ap?M.trim(ap[1]):"",ay=ap?M("<div"+(ap[2]||"")+"></div>")[0].attributes:"",aw=ay.length,ax=(M.browser.webkit||M.browser.mozilla)?y[0].contentWindow.document:l,ao=M(ax).find("head").find("link"),au=ax.getElementsByTagName("head")[0];m.val(av);au.innerHTML=av.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");M(au).append(ao);ax.body.innerHTML=al(at);while(aw--){ax.body.setAttribute(ay[aw].name,ay[aw].value)}if(aq!==false){clearTimeout(af);af=setTimeout(function(){E.refresh()},aq||100)}if(typeof ar=="undefined"||ar===true){u()}}function al(ao){return ao}function O(){return R.val()+T.val()+a.val()+J.val()+W.val()}function N(ar,aq,at,ap,ao){if(M.isFunction(aq)){if(M.isFunction(at)){ap=at}at=aq;aq={}}M.ajax({type:"POST",url:ajaxurl,data:M.extend({action:"mailster_"+ar,_wpnonce:A},aq),success:function(av,aw,au){at&&at.call(this,av,aw,au)},error:function(au,aw,av){if(aw=="error"&&!av){return}if(console){console.error(M.trim(au.responseText))}ap&&ap.call(this,au,aw,av)},dataType:ao?ao:"JSON"})}function n(ao){return M.trim(ao).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ad(){var aC,ay,au,ap,av=new Date(),ao=M(".time"),aq=M(".deliverytime").eq(0),ax=M("#mailster_data_active"),aB=parseInt(ao.data("timestamp"),10)*1000,aA=true,ar=aB-av.getTime()+(av.getTimezoneOffset()*60000);var at=(aA)?1000:20000;function az(){aC=new Date();av=aC.getTime();aC.setTime(av+ar);au=aC.getHours();ap=aC.getMinutes();if(!e&&ay&&ap!=ay[1]&&!ax.is(":checked")){aq.val(aw(au)+":"+aw(ap))}ay=[];ay.push(aC.getHours());ay.push(aC.getMinutes());if(aA){ay.push(aC.getSeconds())}for(var aD=0;aD<3;aD++){ay[aD]=aw(ay[aD])}ao.html(ay.join('<span class="blink">:</span>'));setTimeout(function(){az()},at)}function aw(aD){return(aD<10)?"0"+aD:aD}az()}function p(){var ao=Array.prototype.slice.call(arguments),at=ao.shift(),ar=ao.length,aq;for(var ap=0;ap<ar;ap++){aq=new RegExp("%("+(ap+1)+"\\$)?(s|d|f)");at=at.replace(aq,ao[ap])}return at}function ai(ap,ar){ap=ap.eq(0);if(ap.is("img")&&ap.attr("src")){var aq=new Image(),ao;aq.onload=function(){ao=((aq.width/ap.width()).toFixed(1)||1);if(ar){ar.call(this,aq.width,aq.height,isFinite(ao)?parseFloat(ao):1)}};aq.src=ap.attr("src")}}function k(aq,ap,ao,ar){return(ar===false?"":"#")+((1<<24)+(aq<<16)+(ap<<8)+ao).toString(16).slice(1)}if(document.selection&&document.selection.createRange){j=function(ap,ar,aq){ap.focus();ap.select();var ao=document.selection.createRange();ao.collapse(true);ao.moveEnd("character",aq);ao.moveStart("character",ar);ao.select();return true}}else{j=function(ao,aq,ap){ao.selectionStart=aq;ao.selectionEnd=ap;return true}}if(window.getSelection){s=function(ap){var ar="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var aq=document.activeElement.value;ar=aq.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ao=window.getSelection();ar=ao.toString()}return ar}}else{s=function(ap){var aq="";if(document.selection.createRange){var ao=document.selection.createRange();aq=ao.text}return aq}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}var ao=typeof document.body.style.maxHeight==="undefined";jQuery("#TB_window").css({marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"});if(!ao){jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px"})}};ag()});