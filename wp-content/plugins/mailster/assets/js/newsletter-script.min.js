jQuery(document).ready(function(N){var ac=N(window),C=N("body"),z=N("#mailster_iframe"),V=N("#template-wrap"),aa,m,x=N("#mailster_template .inside"),e=!!N("#mailster_disabled").val(),S=N("#title"),K=N("#mailster_subject"),X=N("#mailster_preheader"),U=N("#content"),a=N("#excerpt"),Z=N("#modules"),ab=N("#plain-text-wrap"),J=N("#html-wrap"),n=N("#head"),r=N("#optionbar"),E=[],T=N("#post_ID").val(),al=0,b=N("#clickmap-stats"),R=N('[name^="mailster_data"]'),l=N(".mailster-color"),B=N("#mailster_nonce").val(),D=false,ag,A,F,f,h,I,ad=N.browser.webkit?C:N("html"),t,j,ai=false,s="ontouchstart" in document.documentElement,i=typeof tinymce=="object";function ah(){G(true);ae();m=(z[0].contentWindow||z[0].contentDocument);if(m.document){m=m.document}W();var ap=setTimeout(function(){if(!D){z.trigger("load")}},5000);z.load(function(){if(D){return false}if(!e){if(!f){f=new af()}if(!I){I=new ao()}if(!F){F=new an()}}else{}y();D=true;w();L(0,0);v();clearInterval(ap);if(typeof autosaveLast!="undefined"){window.autosaveLast=(typeof wp!="undefined"&&wp.autosave)?wp.autosave.getCompareString():S.val()+U.val()+a.val()}if(typeof wp!="undefined"){if(wp.autosave&&wp.autosave.server&&typeof wp.autosave.server.postChanged=="function"){window.mailster_autosave=P();wp.autosave.server.postChanged=function(){return window.mailster_autosave!=P()}}}aa=z.contents().find("body");if(e){S.prop("disabled",true);window.autosave=wp.autosave=function(){return true};window.onbeforeunload=null;aa.on("click","a",function(){window.open(this.href);return false})}else{}ac.trigger("resize");N("#normal-sortables").on("sortupdate",function(aq,ar){ac.trigger("resize")});V.removeClass("load")});ac.on("resize.mailster",w);window.mailster_refresh=function(){w();v()};window.mailster_hideButtons=function(){x.find(".content.mailster-btn").remove()};if(/post_status=autoresponder/.test(N("#referredby").val())||/post_status=autoresponder/.test(location.search)){N("#mailster_delivery").find('a[href="#autoresponder"]').click()}if(N.browser.msie){C.addClass("ie")}if(s){C.addClass("touch")}}function W(){C.on("click","a.external",function(){window.open(this.href);return false}).on("change","input[name=screen_columns]",function(){ac.trigger("resize")});if(!e){S.change(function(){if(!K.val()){K.val(N(this).val())}});N("#use_pwd").on("change",function(){N("#password-wrap").slideToggle(200).find("input").focus().select();N("#post_password").prop("disabled",!N(this).is(":checked"))});N("#post").on("submit",function(){if(ai){return false}v()});N(".sendnow-button").on("click",function(){if(!confirm(mailsterL10n.send_now)){return false}});N("#local-storage-notice").on("click",".restore-backup, .undo-restore-backup",function(){G();setTimeout(function(){var ar=U.val();if(!ar){D=F=false;z[0].contentWindow.location.reload()}else{Q(ar,false);y();w()}N("#local-storage-notice").slideUp()},100);return false}).find(".restore-backup").off("click.autosave-local");N("#mailster_delivery").on("change","input.timezone",function(){N(".active_wrap").toggleClass("timezone-enabled")}).on("change","input.autoresponder-timezone",function(){N(".autoresponderfield-mailster_autoresponder_timebased").toggleClass("timezone-enabled")}).on("change","input.userexactdate",function(){var ar=N(this).parent().parent().parent();ar.find("span").toggleClass("disabled")});N("#editbar, #mailster_delivery").on("change",".dynamic_embed_options_taxonomy",function(){var ar=N(this),at=ar.val();ar.parent().find(".button").remove();if(at!=-1){if(ar.parent().find("select").length<ar.find("option").length-1){N(' <a class="button button-small add_embed_options_taxonomy">'+mailsterL10n.add+"</a>").insertAfter(ar)}}else{ar.parent().html("").append(ar)}return false}).on("click",".add_embed_options_taxonomy",function(){var at=N(this),ar=at.prev().clone();ar.insertBefore(at).val("-1");N("<span> "+mailsterL10n.or+" </span>").insertBefore(ar);at.remove();return false});N("#autoresponder-post_type").on("change",function(){var ar=N("#autoresponder-taxonomies");ar.find("select").prop("disabled",true);O("get_post_term_dropdown",{labels:false,names:true,posttype:N(this).val()},function(at){if(at.success){ar.html(at.html)}},function(at,av,au){loader(false);alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)})});N(".default-value").on("click",function(){var ar=N(this);N("#"+ar.data("for")).val(ar.data("value"))});N(".category-tabs").on("click","a",function(){var at=N(this),ar=at.attr("href");N("#mailster_delivery").find(".tabs-panel").hide();N("#mailster_delivery").find(".tabs").removeClass("tabs");at.parent().addClass("tabs");N(ar).show();N("#mailster_is_autoresponder").val((ar=="#autoresponder")?1:"");return false});N(".mailster_sendtest").on("click",function(){var at=N(this),ar=N("#delivery-ajax-loading").css({display:"inline"});at.prop("disabled",true);v();O("send_test",{formdata:N("#post").serialize(),to:N("#mailster_testmail").val(),content:U.val(),plaintext:a.val()},function(au){ar.hide();at.prop("disabled",false);var av=N('<div class="'+((!au.success)?"error":"updated")+'"><p>'+au.msg+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){av.remove()})},function(au,ax,av){ar.hide();at.prop("disabled",false);var aw=N('<div class="error"><p>'+ax+" "+au.status+": "+av+"</p></div>").hide().prependTo(at.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aw.remove()})})});N(".mailster_spamscore").on("click",function(){var aw=N(this),ar=N("#delivery-ajax-loading").css({display:"inline"}),av=N("#spam_score_progress").removeClass("spam-score").slideDown(200),au=av.find(".bar");aw.prop("disabled",true);N(".score").html("");v();au.css({width:"0"}).css({width:"20%"});O("send_test",{ID:T,subject:K.val(),from:N("#mailster_from").val(),from_name:N("#mailster_from-name").val(),to:N("#mailster_testmail").val(),reply_to:N("#mailster_reply_to").val(),spamtest:true,template:N("#mailster_template_name").val(),preheader:X.val(),embed_images:N("#mailster_data_embed_images").is(":checked"),issue:N("#mailster_autoresponder_issue").val(),content:U.val(),plaintext:a.val(),autoplain:N("#plaintext").is(":checked"),head:n.val()},function(ax){if(ax.success){au.css({width:"40%"});at(ax.id,1)}else{ar.hide();av.slideUp(200);var ay=N('<div class="error"><p>'+ax.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ay.remove()})}},function(ax,aA,ay){ar.hide();aw.prop("disabled",false);var az=N('<div class="error"><p>'+aA+" "+ax.status+": "+ay+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){az.remove()})});function at(ay,ax){O("check_spam_score",{ID:ay},function(aA){if(aA.score){ar.hide();aw.prop("disabled",false);av.addClass("spam-score");au.css({width:(parseFloat(aA.score)*10)+"%"},400);N(".score").html("<strong>"+q(mailsterL10n.yourscore,aA.score)+"</strong>:<br>"+mailsterL10n.yourscores[Math.floor((aA.score/10)*mailsterL10n.yourscores.length)])}else{if(ax<=5&&!aA.abort){var az=(ax*10)+50;au.css({width:(az)+"%"},ax*400+5000);setTimeout(function(){at(ay,++ax)},ax*400)}else{ar.hide();aw.prop("disabled",false);au.css({width:"100%"},10);av.slideUp(200);var aB=N('<div class="error"><p>'+aA.msg+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})}}},function(az,aC,aA){ar.hide();aw.prop("disabled",false);var aB=N('<div class="error"><p>'+aC+" "+az.status+": "+aA+"</p></div>").hide().prependTo(aw.parent()).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){aB.remove()})})}});N("#mailster_data_active").on("change",function(){var ar=N(this).is(":checked");(ar)?N(".active_wrap").addClass("disabled"):N(".active_wrap").removeClass("disabled");N(".deliverydate, .deliverytime").prop("disabled",!ar)});N("#mailster_data_autoresponder_active").on("change",function(){var ar=N(this).is(":checked");(ar)?N(".autoresponder_active_wrap").addClass("disabled"):N(".autoresponder_active_wrap").removeClass("disabled")});var ap=N("input.color");var aq=N(".colors").data("original-colors");ap.wpColorPicker({color:true,width:250,mode:"hsl",palettes:aq,change:function(ar,at){N(this).val(at.color.toString()).trigger("change")},clear:function(ar,at){}});N(".wp-color-result").on("click",function(){N(this).closest("li.mailster-color").addClass("open")});ap.on("change",function(){var at=N(this);var ar=at.data("value");M(ar,at.val(),at)});if(typeof jQuery.datepicker=="object"){N("input.datepicker").datepicker({dateFormat:"yy-mm-dd",minDate:new Date(),firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn",onClose:function(){var ar=N(this).datepicker("getDate");N(".deliverydate").html(N(this).val())}});N("input.datepicker.nolimit").datepicker("option","minDate",null)}else{N("input.datepicker").prop("readonly",false)}N("input.datepicker").on("focus",function(){N(this).removeClass("inactive").trigger("click")}).on("blur",function(){N(".deliverydate").html(N(this).val());N(this).addClass("inactive")}).on("change",function(){});N("input.deliverytime").on("blur",function(){N(document).unbind(".mailster_deliverytime")}).on("focus, click",function(aw){var ax=N(this),at=N(this)[0],ar=ax.offset().left,ay=0,av=0,au=2;if(aw.clientX-ar>23){ay=1,av=3,au=5}N(document).unbind(".mailster_deliverytime").on("keypress.mailster_deliverytime",function(az){if(az.keyCode==9){return(ay=!ay)?!j(at,3,5):(az.shiftKey)?!j(at,0,2):true}}).on("keyup.mailster_deliverytime",function(az){if(ax.val().length==1){ax.val(ax.val()+":00");j(at,1,1)}if(document.activeElement.selectionStart==2){if(ax.val().substr(0,2)>23){ax.trigger("change");return false}j(at,3,5)}});j(at,av,au)}).on("change",function(){var at=N(this),au=at.val(),ar;at.addClass("inactive");if(!/^\d+:\d+$/.test(au)){if(au.length==1){au="0"+au+":00"}else{if(au.length==2){au=au+":00"}else{if(au.length==3){au=au.substr(0,2)+":"+au.substr(2,3)+"0"}else{if(au.length==4){au=au.substr(0,2)+":"+au.substr(2,4)}}}}}ar=au.split(":");if(!/\d\d:\d\d$/.test(au)&&au!=""||ar[0]>23||ar[1]>59){at.val("00:00").focus();j(at[0],0,2)}else{at.val(au)}});N("#mailster_autoresponder_action").on("change",function(){N("#autoresponder_wrap").removeAttr("class").addClass("autoresponder-"+N(this).val())});N("#mailster_autoresponder_advanced_check").on("change",function(){N("#mailster_autoresponder_advanced").slideToggle()});N("#time_extra").on("change",function(){N("#autoresponderfield-mailster_timebased_advanced").slideToggle()});N("#mailster_attachments").on("click",".delete-attachment",function(){event.preventDefault();N(this).parent().remove()}).on("click",".add-attachment",function(){event.preventDefault();if(!wp.media.frames.mailster_attachments){wp.media.frames.mailster_attachments=wp.media({title:mailsterL10n.add_attachment,button:{text:mailsterL10n.add_attachment},multiple:false});wp.media.frames.mailster_attachments.on("select",function(){var at=wp.media.frames.mailster_attachments.state().get("selection").first().toJSON(),ar=N(".mailster-attachment").eq(0).clone();ar.find("img").attr("src",at.icon);ar.find(".mailster-attachment-label").html(at.filename);ar.find("input").attr("name","mailster_data[attachments][]").val(at.id);ar.appendTo(".mailster-attachments")})}wp.media.frames.mailster_attachments.open()});N("#mailster_autoresponder_advanced").on("click",".add-condition",function(){var ar=N(".mailster_autoresponder_condition"),au=ar.length,at=ar.last().clone();at.hide().removeAttr("id").insertAfter(ar.last()).slideDown();N.each(at.find("input, select"),function(){var av=N(this).val("").attr("name");N(this).attr("name",av.replace(/\[\d+\]/,"["+au+"]"))})}).on("click",".remove-condition",function(){N(this).parent().parent().slideUp(function(){N(this).remove()})});N("#autoresponder_wrap").on("click",".mailster_autoresponder_timebased-end-schedule",function(){var ar=N(this).is(":checked");(ar)?N(".mailster_autoresponder_timebased-end-schedule-field").slideDown():N(".mailster_autoresponder_timebased-end-schedule-field").slideUp()});N("#mailster_receivers").on("change","input.list",function(){var at=[],ay=[],au=N("#list-checkboxes").find("input, select"),av=N("#list-checkboxes").find("input.list"),ar=N("#list_extra"),ax={},aw=N("#mailster_total");N("input.list-parent-"+N(this).val()).prop("checked",N(this).prop("checked"));N.each(av,function(){var az=N(this).val();if(N(this).is(":checked")){at.push(az)}});ax.lists=at;ax.ignore_lists=N("#ignore_lists").is(":checked");if(ar.is(":checked")){N.each(N(".mailster_list_condition"),function(){var aB=N(this),az=aB.find("select"),aA=aB.find("input");ay.push({field:az.eq(0).val(),operator:az.eq(1).val(),value:aA.eq(0).val()})});ax.operator=N("#mailster_list_operator").val();ax.conditions=ay}aw.addClass("loading");G();O("get_totals",ax,function(az){y();aw.removeClass("loading").html(az.totalformated)},function(az,aB,aA){y();aw.removeClass("loading").html("?");alert(aB+" "+az.status+": "+aA+"\n\n"+mailsterL10n.check_console)})}).on("change","#all_lists",function(){N("#list-checkboxes").find("input.list").prop("checked",N(this).is(":checked")).eq(0).trigger("change")}).on("change","#ignore_lists",function(){var ar=N(this).is(":checked");N("#list-checkboxes").each(function(){(ar)?N(this).slideUp(200):N(this).slideDown(200)}).find("input.list").eq(0).trigger("change")}).on("change","#mailster_list_operator",function(){N("#mailster_list_conditions").removeClass("operator-is-OR operator-is-AND").addClass("operator-is-"+N(this).val())});N("#mailster_total").on("click",function(){N("#list-checkboxes").find("input.list").eq(0).trigger("change")});N("#mailster_list_advanced").on("click",".add-condition",function(){var ar=N(".mailster_list_condition"),au=ar.length,at=ar.last().clone();at.hide().removeAttr("id").insertAfter(ar.last()).slideDown();N.each(at.find("input, select"),function(){var av=N(this).prop("disabled",false).val("").attr("name");N(this).attr("name",av.replace(/\[\d+\]/,"["+au+"]")).removeClass("hasDatepicker").removeAttr("id")})}).on("click",".remove-condition",function(){N(this).parent().parent().slideUp(function(){N(this).remove();N("#list-checkboxes").find("input.list").eq(0).trigger("change")})}).on("change.datefields","select.condition-field",function(){var ar=N(this);if(typeof jQuery.datepicker!="object"){return}if(ar.parent().find("input").data("datepicker")){ar.parent().find("input").datepicker("destroy")}if(N.inArray(ar.val(),mailsterdata.datefields)!==-1){ar.parent().find("input").datepicker({dateFormat:"yy-mm-dd",firstDay:mailsterL10n.start_of_week,showWeek:true,dayNames:mailsterL10n.day_names,dayNamesMin:mailsterL10n.day_names_min,monthNames:mailsterL10n.month_names,prevText:mailsterL10n.prev,nextText:mailsterL10n.next,showAnim:"fadeIn"})}}).on("change","select, input",function(){N("#list-checkboxes").find("input.list").eq(0).trigger("change")}).find("select.condition-field").trigger("change.datefields");N("#list_extra").on("change",function(){if(N(this).is(":checked")){N("#mailster_list_advanced").slideDown()}else{N("#mailster_list_advanced").slideUp()}N("#list-checkboxes").find("input.list").eq(0).trigger("change")});N("#mailster_options").on("click","a.default-value",function(){var at=N(this).prev().find("input"),ar=at.data("default");at.wpColorPicker("color",ar);return false}).on("click","ul.colorschema",function(){var at=N("#mailster_options").find("input.color"),ar=N(this).find("li.colorschema-field");G();N.each(ar,function(av){var au=ar.eq(av).data("hex");at.eq(av).wpColorPicker("color",au)});y()}).on("click","a.savecolorschema",function(){var at=N.map(N("#mailster_options").find(".color"),function(au){return N(au).val()});var ar=N("#colorschema-ajax-loading").css({display:"inline"});O("save_color_schema",{template:N("#mailster_template_name").val(),colors:at},function(au){ar.hide();if(au.success){N(".colorschema").last().after(N(au.html).hide().fadeIn())}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)})}).on("click",".colorschema-delete",function(){if(confirm(mailsterL10n.delete_colorschema)){var at=N(this).parent().parent();var ar=N("#colorschema-ajax-loading").css({display:"inline"});O("delete_color_schema",{template:N("#mailster_template_name").val(),hash:at.data("hash")},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)})}return false}).on("click",".colorschema-delete-all",function(){if(confirm(mailsterL10n.delete_colorschema_all)){var at=N(".colorschema.custom");var ar=N("#colorschema-ajax-loading").css({display:"inline"});O("delete_color_schema_all",{template:N("#mailster_template_name").val()},function(au){ar.hide();if(au.success){at.fadeOut(100,function(){at.remove()})}},function(au,aw,av){ar.hide();alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)})}return false}).on("change","#mailster_version",function(){var ar=N(this).val();H(ar)}).on("click","ul.backgrounds ul a",function(){N("ul.backgrounds").find("a").removeClass("active");var ar=N(this).parent().parent().data("base"),at=N(this).addClass("active").data("file");if(!at){ar=""}N("#mailster_background").val(ar+at);Y(ar+at)}).on("mouseenter","ul.backgrounds a",function(){var at=N(this).parent().parent().data("base"),ar=N(this).data("file");if(ar){N("ul.backgrounds a").eq(0).css({"background-image":"url("+at+N(this).data("file")+")"})}}).on("mouseleave","ul.backgrounds a",function(){N("ul.backgrounds a").eq(0).css({"background-image":"url("+N.trim(N("#mailster_background").val())+")"})});x.on("click","a.addbutton",function(){var at=N(this).data(),ar=at.element.find("img").length?'<a href="" editable label="Button"><img alt=""></a>':'<a href="" editable label="Button"></a>';I.open({type:"btn",offset:at.offset,element:N(ar).appendTo(at.element),name:at.name});return false}).on("click","a.addrepeater",function(){var ar=N(this).data();ar.element.clone().insertAfter(ar.element);w();return false}).on("click","a.removerepeater",function(){var ar=N(this).data();ar.element.remove();w();return false});N(".mailster-preview-iframe").on("load",function(){var aw=N(this),at=aw.contents().find("body");if(aw.is(".mobile")){var au=at.find("style").text(),ar=/@media/.test(au);if(!ar){var av=0.85;at.css({zoom:av,"-moz-transform":"scale("+av+")","-moz-transform-origin":"0 0",transform:"scale("+av+")","transform-origin":"0 0"})}}at.on("click","a",function(){var ax=N(this).attr("href");if(ax&&ax!="#"){window.open(ax)}return false})});ab.on("click","a.button",function(){var ar=a.val();a.val(mailsterL10n.loading);O("get_plaintext",{html:g()},function(at){a.val(at)},function(at,av,au){a.val(ar);alert(av+" "+at.status+": "+au+"\n\n"+mailsterL10n.check_console)},"HTML")}).on("change","#plaintext",function(){var ar=N(this).is(":checked");a.prop("disabled",ar)[ar?"addClass":"removeClass"]("disabled")});if(typeof wp!="undefined"&&wp.heartbeat){N(document).on("heartbeat-send",function(at,ar){if(ar.wp_autosave){ar.wp_autosave["content"]=g();ar.wp_autosave["excerpt"]=a.val();ar.mailsterdata=R.serialize()}})}}else{S.prop("disabled",true);N("#change-permalinks").remove();if(typeof autosavePeriodical!="undefined"){autosavePeriodical.repeat=false}N("#show_recipients").on("click",function(){var au=N(this),at=N("#recipients-list"),ar=N("#recipients-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});O("get_recipients",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#show_clicks").on("click",function(){var au=N(this),at=N("#clicks-list"),ar=N("#clicks-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});O("get_clicks",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#show_environment").on("click",function(){var au=N(this),at=N("#environment-list"),ar=N("#environment-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});O("get_environment",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#show_geolocation").on("click",function(){var au=N(this),at=N("#geolocation-list"),ar=N("#geolocation-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});O("get_geolocation",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100,function(){var az,aA,aC={legend:false,region:"world",resolution:"countries",datalessRegionColor:"#ffffff",enableRegionInteractivity:true,colors:["#d7f1fc","#2BB3E7"],backgroundColor:{fill:"none",stroke:null,strokeWidth:0}},ay;var aE;google.load("visualization","1.0",{packages:["geochart","corechart"],callback:function(){aE=new google.visualization.GeoChart(document.getElementById("countries_map"));az=aA=google.visualization.arrayToDataTable(av.countrydata);if(location.hash&&(ay=location.hash.match(/region=([A-Z]{2})/))){aw(ay[1])}else{aD()}google.visualization.events.addListener(aE,"regionClick",aw)}});N("a.zoomout").on("click",function(){ax();return false});N("#countries_table").find("tbody").find("tr").on("click",function(){var aF=N(this).data("code");(aF=="unknown"||!aF)?ax():aw(aF);return false});function ax(){var aF={region:"world",displayMode:"region",resolution:"countries",colors:["#D7E4E9","#2BB3E7"]};az=aA;aD(aF);N("#countries_table").find("tr").removeClass("wp-ui-highlight");N("#mapinfo").hide();location.hash="#region="}function aw(aG){var aF={},aH=aG.region?aG.region:aG,aI;if(aH.match(/-/)){return false}aF.region=aH;(av.unknown_cities[aH])?N("#mapinfo").show().html("+ "+av.unknown_cities[aH]+" unknown locations"):N("#mapinfo").hide();aI=av.geodata[aH]?av.geodata[aH]:[];aF.resolution="provinces";aF.displayMode="markers";aF.dataMode="markers";aF.colors=["#4EBEE9","#2BB3E7"];az=new google.visualization.DataTable();az.addColumn("number","Lat");az.addColumn("number","Long");az.addColumn("string","tooltip");az.addColumn("number","Value");az.addColumn({type:"string",role:"tooltip"});az.addRows(aI);N("#countries_table").find("tr").removeClass("wp-ui-highlight");N("#country-row-"+aH).addClass("wp-ui-highlight");location.hash="#region="+aH;aD(aF)}function aD(aF){aF=N.extend(aC,aF);aE.draw(az,aF);N("a.zoomout").css({visibility:(aC.region!="world"?"visible":"hidden")})}function aB(aG){var aF=aG;N.each(regions,function(aH,aI){if(N.inArray(aG,aI)!=-1){aF=aH}});return aF}})},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#show_errors").on("click",function(){var au=N(this),at=N("#error-list"),ar=N("#error-ajax-loading");if(!at.is(":hidden")){au.removeClass("open");at.slideUp(100);return false}ar.css({display:"inline"});O("get_errors",{id:T},function(av){au.addClass("open");ar.hide();at.html(av.html).slideDown(100)},function(av,ax,aw){ar.hide();alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#show_countries").on("click",function(){N("#countries_wrap").toggle();return false});N("#mailster_details").on("click",".load-more-receivers",function(){var ax=N(this),aw=ax.data("page"),au=ax.data("types"),av=ax.data("orderby"),at=ax.data("order"),ar=ax.next().css({display:"inline"});O("get_recipients_page",{id:T,types:au,page:aw,orderby:av,order:at},function(ay){ar.hide();if(ay.success){ax.parent().parent().replaceWith(ay.html)}},function(ay,aA,az){detailbox.removeClass("loading");alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false}).on("click",".recipients-limit",function(ar){if(ar.altKey){N("input.recipients-limit").prop("checked",false);N(this).prop("checked",true)}}).on("change",".recipients-limit, select.recipients-order",function(av){var ax=N("#recipients-list"),at=N("#recipients-ajax-loading"),au=N("input.recipients-limit:checked").map(function(){return this.value}).get(),aw=N("select.recipients-order").val(),ar=N("a.recipients-order").hasClass("asc")?"ASC":"DESC";at.css({display:"inline"});N("input.recipients-limit").prop("disabled",true);O("get_recipients",{id:T,types:au.join(","),orderby:aw,order:ar},function(ay){at.hide();N("input.recipients-limit").prop("disabled",false);ax.html(ay.html).slideDown(100)},function(ay,aA,az){at.hide();alert(aA+" "+ay.status+": "+az+"\n\n"+mailsterL10n.check_console)});return false}).on("click","a.recipients-order",function(){N(this).toggleClass("asc");N("select.recipients-order").trigger("change")}).on("click",".show-receiver-detail",function(){var ar=N(this),au=ar.data("id"),at=N("#receiver-detail-"+au).show();ar.parent().addClass("loading").parent().addClass("expanded");O("get_recipient_detail",{id:au,campaignid:T},function(av){ar.parent().removeClass("loading");if(av.success){at.find("div.receiver-detail-body").html(av.html).slideDown(100)}},function(av,ax,aw){at.removeClass("loading");alert(ax+" "+av.status+": "+aw+"\n\n"+mailsterL10n.check_console)});return false});N("#stats").on("click","label",function(){N("#recipients-list").find("input").prop("checked",false).filter("input."+N(this).attr("class")).prop("checked",true).trigger("change")});x.on("mouseenter","a.clickbadge",function(){var ax=N(this),ar=ax.position(),aw=ax.data("p"),av=ax.data("link"),at=ax.data("clicks"),au=ax.data("total");b.find(".piechart").data("easyPieChart").update(aw);b.find(".link").html(av);b.find(".clicks").html(at);b.find(".total").html(au);b.stop().fadeIn(100).css({top:ar.top-85,left:ar.left-(b.width()/2-ax.width()/2)})}).on("mouseleave","a.clickbadge",function(){b.stop().fadeOut(400)});N("#mailster_receivers").on("click",".create-new-list",function(){var ar=N(this).hide();N(".create-new-list-wrap").slideDown();N(".create-list-type").trigger("change");return false}).on("click",".create-list",function(){var av=N(this),au=N(".create-list-type"),at="",ar=N("#mailster_total");if(au.val()==-1){return false}if(at=prompt(mailsterL10n.enter_list_name,q(mailsterL10n.create_list,au.find(":selected").text(),N("#title").val()))){ar.addClass("loading");O("create_list",{name:at,listtype:au.val(),id:T},function(aw){ar.removeClass("loading");var ax=N('<div class="'+((!aw.success)?"error":"updated")+'"><p>'+aw.msg+"</p></div>").hide().prependTo(N(".create-new-list-wrap")).slideDown(200).delay(200).fadeIn().delay(3000).fadeTo(200,0).delay(200).slideUp(200,function(){ax.remove()})},function(aw,ay,ax){ar.removeClass("loading");alert(ay+" "+aw.status+": "+ax+"\n\n"+mailsterL10n.check_console)})}return false}).on("change",".create-list-type",function(){var at=N(this),ar=N("#mailster_total");if(at.val()==-1){return false}at.prop("disabled",true);ar.addClass("loading");O("get_create_list_count",{listtype:at.val(),id:T},function(au){at.prop("disabled",false);ar.removeClass("loading").html(au.count)},function(au,aw,av){at.prop("disabled",false);ar.removeClass("loading").html("");alert(aw+" "+au.status+": "+av+"\n\n"+mailsterL10n.check_console)})});N("#mailster_total").on("click",function(){N(".create-list-type").trigger("change")});N(".piechart").easyPieChart({animate:2000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(ar){this.$el.find("span").text(Math.round(ar))},onStop:function(ar){this.$el.find("span").text(Math.round(ar))}});if(typeof wp!="undefined"&&wp.heartbeat){N(document).on("heartbeat-send",function(at,ar){if(ar.wp_autosave){delete ar.wp_autosave}ar.mailster={page:"edit",id:T}}).on("heartbeat-tick",function(ay,aw){if(!aw.mailster[T]){return}var au=aw.mailster[T],at=N("#stats").find(".verybold"),av=N("#stats").find(".piechart"),ar=N(".progress"),ax=(au.sent/au.total*100);N(".hb-sent").html(au.sent_f);N(".hb-opens").html(au.opens_f);N(".hb-clicks").html(au.clicks_f);N(".hb-clicks_total").html(au.clicks_total_f);N(".hb-unsubs").html(au.unsubs_f);N(".hb-bounces").html(au.bounces_f);N(".hb-geo_location").html(au.geo_location);N.each(au.environment,function(az){N(".hb-"+az).html((this.percentage*100).toFixed(2)+"%")});av.eq(0).data("easyPieChart").update(Math.round(au.open_rate));av.eq(1).data("easyPieChart").update(Math.round(au.click_rate));av.eq(2).data("easyPieChart").update(Math.round(au.unsub_rate));av.eq(3).data("easyPieChart").update(Math.round(au.bounce_rate));ar.find(".bar").width(ax+"%");ar.find("span").eq(1).html(au.sent_formatted);ar.find("var").html(Math.round(ax)+"%");d(au.clickbadges);if(au.status!=N("#original_post_status").val()&&!N("#mailster_status_changed_info").length){N('<div id="mailster_status_changed_info" class="error inline"><p>'+q(mailsterL10n.statuschanged,'<a href="post.php?post='+T+'&action=edit">'+mailsterL10n.click_here+"</a></p></div>")).hide().prependTo("#postbox-container-2").slideDown(200)}});wp.heartbeat.interval("fast")}}}var af=function(){var ar,at=x.offset();function aE(){r.on("click","a.template",aC).on("click","a.save-template",aA).on("click","a.clear-modules",aw).on("click","a.preview",ay).on("click","a.undo",aD).on("click","a.redo",az).on("click","a.code",au).on("click","a.plaintext",av).on("click","a.dfw",ap);C.on("click","button.save-template",aB).on("click","button.save-template-cancel",tb_remove);ac.on("scroll.optionbar",function(){var aF=ac.scrollTop();if(aF<at.top-50||aF>at.top+x.height()-120){if(/fixed-optionbar/.test(C[0].className)){C.removeClass("fixed-optionbar")}r.width("auto")}else{if(!/fixed-optionbar/.test(C[0].className)){C.addClass("fixed-optionbar")}r.width(x.width())}}).on("resize.optionbar",function(){at=x.offset();ac.trigger("scroll.optionbar")})}function aA(){tb_show(mailsterL10n.save_template,"#TB_inline?x=1&width=480&height=320&inlineId=mailster_template_save",null);N("#new_template_name").focus().select();return false}function aB(){G();var aI=N("#new_template_name").val();if(!aI){return false}v();var aF=N("#new_template-ajax-loading").css({display:"inline"}),aH=N("#new_template_modules").is(":checked"),aL=N("#new_template_active_modules").is(":checked"),aJ=N("#new_template_saveas_dropdown").val(),aG=!!parseInt(N('input[name="new_template_overwrite"]:checked').val(),10),aK=g();O("create_new_template",{name:aI,modules:aH,activemodules:aL,overwrite:aG?aJ:false,template:N("#mailster_template_name").val(),content:aK,head:n.val()},function(aM){aF.hide();if(aM.success){if(window.wp){window.wp=null}window.location=aM.url}else{alert(aM.msg)}},function(aM,aO,aN){aF.hide();alert(aO+" "+aM.status+": "+aN+"\n\n"+mailsterL10n.check_console)});return false}function aD(){if(al){x.addClass("noeditbuttons");al--;Q(E[al],100,false);U.val(E[al]);r.find("a.redo").removeClass("disabled");if(!al){N(this).addClass("disabled")}}return false}function az(){var aF=E.length;if(al<aF-1){x.addClass("noeditbuttons");al++;Q(E[al],100,false);U.val(E[al]);r.find("a.undo").removeClass("disabled");if(al>=aF-1){N(this).addClass("disabled")}}return false}function aw(){if(confirm(mailsterL10n.remove_all_modules)){x.addClass("noeditbuttons");var aF=z.contents().find("module");var aG=z.contents().find("modules");aG.slideUp(function(){aF.remove();aG.html("").show();w();v()})}return false}function ay(){var aI=N(this),aG=g(),aF=K.val(),aH=S.val();if(r.find("a.preview").is(".loading")){return false}r.find("a.preview").addClass("loading");O("set_preview",{id:T,content:aG,head:n.val(),issue:N("#mailster_autoresponder_issue").val(),subject:aF},function(aJ){r.find("a.preview").removeClass("loading");N(".mailster-preview-iframe").attr("src",ajaxurl+"?action=mailster_get_preview&hash="+aJ.hash+"&_wpnonce="+aJ.nonce);tb_show((aH?q(mailsterL10n.preview_for,'"'+aH+'"'):mailsterL10n.preview),"#TB_inline?hash="+aJ.hash+"&_wpnonce="+aJ.nonce+"&width="+(Math.min(1200,ac.width()-50))+"&height="+(ac.height()-100)+"&inlineId=mailster_campaign_preview",null)},function(aJ,aL,aK){r.find("a.preview").removeClass("loading");alert(aL+" "+aJ.status+": "+aK+"\n\n"+mailsterL10n.check_console)})}function ax(){r.remove()}function aq(){N("#new_template_name").on("focus",function(){N(document).unbind("keypress.mailster").bind("keypress.mailster",function(aF){if(aF.keyCode==13){aB();return false}})}).select().focus().on("blur",function(){N(document).unbind("keypress.mailster")})}function aC(aF){var aG=N(this);aG.parent().find("ul").eq(0).slideToggle(100);return false}function au(){var aG=!z.is(":visible");if(!aG){r.find("a.code").addClass("loading");G();N.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){O("toggle_codeview",{content:g(),head:n.val(),_wpnonce:B},function(aH){r.find("a.code").addClass("active").removeClass("loading");J.hide();U.val(aH.content);r.find("a").not("a.redo, a.undo, a.code").addClass("disabled");x.addClass("noeditbuttons");ar=CodeMirror.fromTextArea(U.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true})},function(aH,aJ,aI){r.find("a.code").addClass("active").removeClass("loading");y();alert(aJ+" "+aH.status+": "+aI+"\n\n"+mailsterL10n.check_console)})})}else{var aF=ar.getValue();ar.clearHistory();Q(aF,100,true);J.show();U.hide();N(".CodeMirror").remove();r.find("a.code").removeClass("active");r.find("a").not("a.redo, a.undo, a.code").removeClass("disabled");x.removeClass("noeditbuttons");y();w()}return false}function av(){var aF=!z.is(":visible");if(!aF){r.find("a.plaintext").addClass("active");J.hide();a.show();ab.show();r.find("a").not("a.redo, a.undo, a.plaintext, a.preview").addClass("disabled");x.addClass("noeditbuttons")}else{J.show();ab.hide();r.find("a.plaintext").removeClass("active");r.find("a").not("a.redo, a.undo, a.plaintext, a.preview").removeClass("disabled");x.removeClass("noeditbuttons");w()}return false}function ap(aF){if(aF.type=="mouseout"&&!/DIV|H3/.test(aF.target.nodeName)){return}at=x.offset();if(!C.hasClass("focus-on")){C.removeClass("focus-off").addClass("focus-on");N("#wpbody").on("mouseleave.dfw",ap);r.find("a.dfw").addClass("active");if(ac.scrollTop()<at.top){c(at.top-80)}}else{C.removeClass("focus-on").addClass("focus-off");N("#wpbody").off("mouseleave",ap);r.find("a.dfw").removeClass("active")}return false}aE();return{hide:function(){ax()}}};var ao=function(){var bf=N("#editbar"),aO,a6={img:0,single:80,multi:0,btn:0,auto:0,codeview:0},a5=bf.find(".imagepreview"),aK=bf.find(".imagewidth"),aG=bf.find(".imageheight"),bn=bf.find(".factor"),a7=bf.find(".highdpi"),aE=bf.find(".imagelink"),bq=bf.find(".imageurl"),bt=bf.find(".orgimageurl"),aw=bf.find(".imagealt"),a8=bf.find(".singlelink"),bp=bf.find(".buttonlink"),aT=bf.find(".buttonlabel"),aD=bf.find(".buttonalt"),aJ=bf.find(".button-nav"),bs=bf.find("ul.buttons"),ba,aP,bh,bk,av,bg,aI,az,aS,aC,aA,aB="x",ar="",at,ap=N("#wp-mailster-editor-wrap"),bd=N("#post-search"),au=N("#image-search");function bm(){bf.on("keyup change","input.live",aq).on("keyup change","#mailster-editor",aq).on("click",".replace-image",a2).on("change",".highdpi",aX).on("click","button.save",aN).on("click",".cancel",ay).on("click","a.remove",aV).on("click","a.reload",bj).on("click","a.single-link-content",aR).on("click","a.add_image",a1).on("click","a.add_image_url",aH).on("click",".imagelist li",aL).on("dblclick",".imagelist li",aN).on("change","#post_type_select input",bj).on("click",".postlist li",bc).on("click",".load-more-posts",bi).on("click","a.btnsrc",br).on("click",".imagepreview",aM).on("click","a.nav-tab",aF).on("change","select.check-for-posts",aY).on("keyup change","#rss_url",bj).on("keyup change","#post-search",a4).on("keyup change","#image-search",a4).on("click","#rss_url",function(){N(this).focus().select()}).on("click",".rss_change",ax).on("click","#recent_feeds a",bb).on("mouseenter","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",aW).on("mouseleave","#wp-mailster-editor-wrap, .imagelist, .postlist, .CodeMirror",bl);aj(z.contents().find("img").eq(0),function(bv,bw,bx){var bu=bx>=1.5;bn.val(bx);a7.prop("checked",bu);(bu)?bf.addClass("high-dpi"):bf.removeClass("high-dpi")});aJ.on("click","a",function(){N(this).parent().find("a").removeClass("nav-tab-active");N(this).parent().parent().find("ul.buttons").hide();var bu=N(this).addClass("nav-tab-active").attr("href");N("#tab-"+bu.substr(1)).show();return false});bq.on("paste change",function(bv){var bu=N(this);setTimeout(function(){var bx=a3(bu.val()),bw=new Image();if(bx){aQ();bw.onload=function(){a5.attr("src",bx);bh={width:bw.width,height:bw.height,asp:bw.width/bw.height};aQ(false)};bw.onerror=function(){if(bv.type!="paste"){alert(q(mailsterL10n.invalid_image,'"'+bx+'"'))}};bw.src=bx}},1)});aK.on("change",function(){aG.val(Math.round(aK.val()/bh.asp))});aG.on("change",function(){aK.val(Math.round(aG.val()*bh.asp))});N("#dynamic_embed_options_post_type").on("change",function(){var bu=N("#dynamic_embed_options_cats");bu.find("select").prop("disabled",true);aQ();O("get_post_term_dropdown",{posttype:N(this).val()},function(bv){aQ(false);if(bv.success){bu.html(bv.html);if(av&&av.terms){var bw=bu.find(".dynamic_embed_options_taxonomy_wrap");N.each(av.terms,function(by,bx){if(!bx){return}var bz=bx.split(",");N.each(bz,function(bB,bD){var bA=bw.eq(by).find("select").eq(bB),bC;if(!bA.length){bC=bw.eq(by).find("select").last();bA=bC.clone();bA.insertAfter(bC);N("<span> "+mailsterL10n.or+" </span>").insertBefore(bA)}bA.val(bD)})})}}aY()},function(bv,bx,bw){aQ(false);alert(bx+" "+bv.status+": "+bw+"\n\n"+mailsterL10n.check_console)})});bf.on("keypress.mailster",function(bu){if(bu.keyCode==13&&bu.target.nodeName.toLowerCase()!="textarea"){return false}}).on("keyup.mailster",function(bu){switch(bu.keyCode){case 27:ay();return false;break;case 13:if(aP.type!="multi"&&aP.type!="codeview"){aN();return false}break}});bf.find(".current-tag").on("click","a",function(){return false});if(bf.draggable){bf.draggable({distance:20,axis:"y"})}if(i&&tinymce.get("mailster-editor")){if(tinymce.majorVersion>=4){tinymce.get("mailster-editor").on("keyup",function(){a0(this)});tinymce.get("mailster-editor").on("ExecCommand",function(){a0(this)})}else{tinymce.get("mailster-editor").onKeyUp.add(function(){a0(this)});tinymce.get("mailster-editor").onExecCommand.add(function(){a0(this)})}}}function bo(bu){if(bf.draggable){if(bu!==false){bf.draggable("enable")}else{bf.draggable("disable")}}}function aW(){bo(false)}function bl(){bo(true)}function aF(bw,bu){var bv;if(typeof bw=="string"){bv=aO.find('a[href="'+bw+'"]')}else{bv=N(this);bw=bv.attr("href")}bv.parent().find("a.nav-tab").removeClass("nav-tab-active");bv.addClass("nav-tab-active");aO.find(".tab").hide();aO.find(bw).show();if(bw=="#dynamic_embed_options"&&bu!==false){N("#dynamic_embed_options_post_type").trigger("change")}if(bw=="#image_button"){ba="image"}if(bw=="#text_button"){ba="text"}aI=aO.find(bw).find(".postlist").eq(0);return false}function a2(){aQ();var bx=bn.val(),bu=aP.element.width(),bw=Math.round(bu/1.6),bv=N("<img>",{src:"https://dummy.newsletter-plugin.com/"+(bu*bx)+"x"+(bw*bx)+".jpg",alt:aP.content,title:aP.content,label:aP.content,width:bu,height:bw,border:0,editable:aP.content});bv[0].onload=function(){bv.attr({width:bu,height:bw}).removeAttr("style");be()};if(aP.element.parent().is("a")){aP.element.unwrap()}if(!aP.element.parent().is("td")){aP.element.unwrap()}aP.element.replaceWith(bv);return false}function aX(){if(N(this).is(":checked")){bn.val(2);bf.addClass("high-dpi")}else{bn.val(1);bf.removeClass("high-dpi")}}function aY(){clearInterval(aS);aQ();N("#dynamic_embed_options").find("h4.current-match").html("&hellip;");N("#dynamic_embed_options").find("div.current-tag").html("&hellip;");aS=setTimeout(function(){var by=bf.find("#dynamic_embed_options_post_type").val(),bv=bf.find("#dynamic_embed_options_content").val(),bx=bf.find("#dynamic_embed_options_relative").val(),bw=bf.find(".dynamic_embed_options_taxonomy_wrap"),bu=[];N.each(bw,function(bB){var bA=N(this).find("select"),bz=[];N.each(bA,function(){var bC=parseInt(N(this).val(),10);if(bC!=-1&&N.inArray(bC,bz)==-1&&!isNaN(bC)){bz.push(bC)}});bz=bz.join(",");if(bz){bu[bB]=bz}});O("check_for_posts",{post_type:by,relative:bx,extra:bu},function(bz){aQ(false);if(bz.success){bk=bz.pattern;N("#dynamic_embed_options").find("h4.current-match").html(bz.title);N("#dynamic_embed_options").find("div.current-tag").text(bz.pattern.title+"\n\n"+bz.pattern[bv])}},function(bz,bB,bA){aQ(false);alert(bB+" "+bz.status+": "+bA+"\n\n"+mailsterL10n.check_console)})},500);return false}function a3(by,bv,bw){var bu;if(/^\{([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?\}$/.test(by)){var bx=bn.val();by=mailsterdata.ajaxurl+"?action=mailster_image_placeholder&tag="+by.replace("{","").replace("}","")+"&w="+((bv||aK.val())*bx)+"&h="+((bw||aG.val())*bx)+"&f="+bx}return by}function aZ(bv){if(-1!==bv.indexOf("?action=mailster_image_placeholder&tag=")){var bu=bv.match(/([a-z0-9-_]+)_image:-?[0-9,;]+(\|\d+)?/);return"{"+bu[0]+"}"}return false}function aq(bu){if((bu.keyCode||bu.which)!=27&&aP){aP.element.html(N(this).val())}}function aQ(bu){if(bu===false){N("#editbar-ajax-loading").hide();bf.find(".buttons").find("button").prop("disabled",false)}else{N("#editbar-ajax-loading").css({display:"inline"});bf.find(".buttons").find("button").prop("disabled",true)}}function aN(){if(aP.type=="img"){var bK=aP.element.is("img");if(bq.val()){bh={id:null,name:"",src:a3(bq.val()),width:bh.width,height:bh.height,asp:bh.width/bh.height}}if(bh){aQ();var bG=bn.val()||1,bB=bK?"src":"background";aP.element.attr({"data-id":bh.id}).data("id",bh.id).addClass("mailster-loading");if(bK){aP.element.attr({width:Math.round(aK.val()),height:Math.round(aG.val()),alt:bh.name})}if(bh.src){aP.element.attr(bB,bh.src);aP.element[0].style.cssText=aP.element[0].style.cssText.replace(/url\("?(.+)"?\)/,"url("+bh.src+")")}O("create_image",{id:bh.id,src:bh.src,width:aK.val()*bG,height:aG.val()*bG},function(bM){aQ(false);if(bM.success){a5.attr("src",bM.image.url);bM.image.width=(bM.image.width||bh.width)/bG;bM.image.height=bM.image.width/(bh.asp);bM.image.asp=bh.asp;bh=bM.image;bh.name=aw.val();if(bK){aP.element.one("load",function(){aP.element.removeClass("mailster-loading");v()});aP.element.attr({width:Math.round(aK.val()),height:Math.round(aG.val()),alt:bh.name})}else{aP.element.removeClass("mailster-loading");var bN=aP.element.html();aP.element.html(ak(bN,bt.val(),bh.url))}aP.element.removeAttr(bB).attr(bB,bh.url)}else{aP.element.removeClass("mailster-loading")}aw.val("");be()},function(bM,bO,bN){aQ(false);alert(bO+" "+bM.status+": "+bN+"\n\n"+mailsterL10n.check_console)})}else{aP.element.attr({alt:aw.val()});be()}if(aP.element.parent().is("a")){aP.element.unwrap()}var bx=aE.val();if(bx){aP.element.wrap('<a href="'+bx+'"></a>')}return false}else{if(aP.type=="btn"){var bx=bp.val();if(!bx&&!confirm(mailsterL10n.remove_btn)){return false}var bw=aO.find("a.active").find("img").attr("src");if(typeof bw=="undefined"){ba="text";if(!aT.val()){aT.val(mailsterL10n.read_more)}}if("image"==ba){var bG=bn.val();var bL=new Image();bL.onload=function(){if(!aP.element.find("img").length){var bN=aP.element.closest("table.textbutton");var bM=N('<a href="" editable label="'+aP.name+'"><img></a>');(bN.length)?bN.replaceWith(bM):aP.element.replaceWith(bM);aP.element=bM}aP.element.find("img").attr({src:bw,width:Math.round((bL.width||aP.element.width())/bG),height:Math.round((bL.height||aP.element.height())/bG),alt:aD.val(),title:aD.val()});(bx)?aP.element.attr("href",bx):aP.element.remove();be()};bL.src=bw}else{var bz=aP.element.closest("table.textbutton"),by=aT.val();if(!bz.length){aP.element.replaceWith('<table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bx+'" editable label="'+by+'">'+by+"</a></td></tr></table>")}else{aP.element.text(by)}if(bx){aP.element.attr("href",bx)}else{aP.element.remove();bz.remove()}be()}return false}else{if(aP.type=="auto"){var bH=N("#embedoption-bar").find(".nav-tab-active").data("type");if("dynamic"==bH){var bC=bf.find("#dynamic_embed_options_content").val();bk.content=bk[bC];aP.element.attr("data-tag",bk.tag).data("tag",bk.tag)}else{if("rss"==bH){var bC=N(".embed_options_content_rss:checked").val();aP.element.removeAttr("data-tag").removeData("tag")}else{var bC=N(".embed_options_content:checked").val();aP.element.removeAttr("data-tag").removeData("tag")}}if(bk){aP.elements.headlines.html("");if(bk.title){aP.elements.headlines.eq(0).html(bk.title)}if(bk.link){if(aP.elements.buttons.length){aP.elements.buttons.last().attr("href",bk.link);aP.elements.buttons.not(":last").remove()}else{aP.elements.bodies.last().after('<buttons><table class="textbutton" align="left"><tr><td align="center" width="auto"><a href="'+bk.link+'" title="'+mailsterL10n.read_more+'" editable label="'+mailsterL10n.read_more+'">'+mailsterL10n.read_more+"</a></td></tr></table></buttons>")}}else{if(aP.elements.buttons.parent().length&&aP.elements.buttons.parent()[0].nodeName=="TD"){aP.elements.buttons.closest("table.textbutton").remove()}else{if(aP.elements.buttons.length){if(aP.elements.buttons.last().find("img").length){aP.elements.buttons.remove()}}}}if(bk[bC]&&aP.elements.bodies.length){var bu=aP.elements.bodies.length,bE=bk[bC],bI=bE.length,bv=(bH=="static")?Math.ceil(bI/bu):bI;for(var bF=0;bF<bu;bF++){aP.elements.bodies.eq(bF).html(bE.substring(bF*bv,bF*bv+bv))}}if(bk.image&&aP.elements.images.length){aQ();var bJ=aP.elements.images.eq(0);var bG=bn.val();if("static"==bH){O("create_image",{id:bk.image.id,width:aP.elements.images.eq(0).width()*bG},function(bM){if(bM.success){aQ(false);bJ.attr({"data-id":bk.image.id,src:bM.image.url,width:Math.round(bM.image.width/bG),height:Math.round(bM.image.height/bG),alt:bk.alt||bk.title}).data("id",bk.image.id);if(bJ.parent().is("a")){bJ.unwrap()}if(bk.link){bJ.wrap("<a>");bJ.parent().attr("href",bk.link)}}be()},function(bM,bO,bN){aQ(false);alert(bO+" "+bM.status+": "+bN+"\n\n"+mailsterL10n.check_console)});return false}else{if("rss"==bH){var bD=bJ.width();bJ.removeAttr("height").removeAttr("data-id").attr({src:a3(bk.image.src,bD),width:bD,alt:bk.alt||bk.title}).removeData("id")}else{var bD=bJ.width();bJ.removeAttr("height").removeAttr("data-id").attr({src:a3(bk.image,bD),width:bD,alt:bk.alt||bk.title}).removeData("id")}}}z.contents().find("html").find("img").each(function(){this.onload=function(){w()}})}}else{if(aP.type=="multi"){if(i&&tinymce.get("mailster-editor")&&!tinymce.get("mailster-editor").isHidden()){aP.element.html(tinymce.get("mailster-editor").getContent())}}else{if(aP.type=="single"){if(aP.conditions){aP.aa="<if";N.each(N(".conditinal-area"),function(){aP.aa=""})}if(aP.element.parent().is("a")){aP.element.unwrap()}var bx=a8.val();if(bx){aP.element.wrap('<a href="'+bx+'"></a>')}}else{if(aP.type=="codeview"){var bA=at.getValue();aP.element.html(am(bA));aP.modulebuttons.prependTo(aP.element)}}}}}}be();return false}function aV(){if(aP.element.parent().is("a")){aP.element.unwrap()}if(!aP.element.parent().is("td")){aP.element.unwrap()}if("btn"==aP.type){var bu=aP.element.closest("table.textbutton");if(bu.length){bu.remove()}}aP.element.remove();be();return false}function ay(){switch(aP.type){case"img":break;case"btn":if(!aP.element.attr("href")){var bu=aP.element.closest("table.textbutton");if(bu.length){bu.remove()}aP.element.remove()}break;default:aP.element.html(aP.content)}be();return false}function br(){var bw=N(this),bu=bw.data("link");aO.find(".btnsrc").removeClass("active");bw.addClass("active");aD.val(bw.attr("title"));if(bu){var bv;bp.val(bu);if((bv=(bu+"").indexOf("USERNAME",0))!=-1){bp.focus();j(bp[0],bv,bv+8)}}return false}function aM(){N(this).toggleClass("zoom")}function aL(bw,bv){var bz=bv||N(this),by=bz.data("id"),bu=bz.data("name"),bx=bz.data("src");bh={id:by,name:bu,src:bx};aQ();aO.find("li.selected").removeClass("selected");bz.addClass("selected");if(aP.element.data("id")==by){aw.val(aP.element.attr("alt"))}else{if(aP.element.attr("alt")!=bu){aw.val(bu)}}bq.val("");a5.attr("src","").on("load",function(){a5.off("load");aP.width=a5.width();aP.height=a5.height();aP.asp=bz.data("asp")||(aP.width/aP.height);bh.asp=aP.asp;aQ(false);aG.val(Math.round(aK.val()/aP.asp))}).attr("src",bx);return bh}function bc(){var by=N(this),bx=by.data("id"),bu=by.data("name"),bv=by.data("link"),bw=by.data("thumbid");if(aP.type=="btn"){bp.val(bv);aD.val(bu);aO.find("li.selected").removeClass("selected");by.addClass("selected")}else{if(aP.type=="single"){a8.val(bv);aO.find("li.selected").removeClass("selected");by.addClass("selected")}else{aQ();O("get_post",{id:bx},function(bz){aQ(false);aO.find("li.selected").removeClass("selected");by.addClass("selected");if(bz.success){bk={title:bz.title,alt:bz.alt,link:bz.link,content:bz.content,excerpt:bz.excerpt,image:bz.image?{id:bz.image.id,src:bz.image.src,name:bz.image.name}:false};aO.find(".editbarinfo").html(mailsterL10n.curr_selected+": <span>"+bk.title+"</span>")}},function(bz,bB,bA){aQ(false);aO.find("li.selected").removeClass("selected");alert(bB+" "+bz.status+": "+bA+"\n\n"+mailsterL10n.check_console)})}}return false}function aU(bO){aP=bO;var bv=bO.element,bG=(bx!="img")?bO.offset.top:0,bP=bO.name||"",bx=bO.type,bI=N.trim(bv.html()),bJ=bv.find("if"),bB,bN,bE,bz,bC=1;aO=bf.find("div.type."+bx);bf.addClass("current-"+bx);aP.width=bv.width();aP.height=bv.height();aP.asp=aP.width/aP.height;aP.content=bI;av=aP.element.data("tag");if(bJ.length){bB={"if":null,elseif:[],"else":null,total:0};bB=[];bf.addClass("has-conditions");bN=aO.find(".conditinal-area");bE=bf.find(".conditions").eq(0);bE.clone().prependTo(bN);N.each(bJ.find("elseif"),function(){var bR=N(this),bQ=bR.html();bB.push({el:bR,html:bQ,field:bR.attr("field"),operator:bR.attr("operator"),value:bR.attr("value")});bR.detach();bN.clone().val(bQ).insertAfter(bN)});N.each(bJ.find("else"),function(){var bR=N(this),bQ=bR.html();bB.push({el:bR,html:bQ});bR.detach();bN.clone().val(bQ).insertAfter(bN)});bB.unshift({el:bJ,html:bJ.html(),field:bJ.attr("field"),operator:bJ.attr("operator"),value:bJ.attr("value")})}else{bf.removeClass("has-conditions")}aP.conditions=bB;if(bx=="img"){bn.val(1);aj(bv,function(bQ,bR,bS){var bR=bS>=1.5;bn.val(bS);a7.prop("checked",bR);(bR)?bf.addClass("high-dpi"):bf.removeClass("high-dpi");bC=bS})}else{if(bx=="btn"){if(bv.find("img").length){N("#button-type-bar").find("a").eq(1).trigger("click");var by=bv.find("img").attr("src");if(aJ.length){var bu=bf.find("img[src='"+by+"']");if(bu.length){bf.find("ul.buttons").hide();var bM=bu.parent().parent().parent();bf.find('a[href="#'+bM.attr("id").substr(4)+'"]').trigger("click")}else{N.each(bf.find(".button-nav"),function(){N(this).find(".nav-tab").eq(0).trigger("click")})}}aT.val(bv.find("img").attr("alt"));aj(bv.find("img"),function(bQ,bR,bS){var bR=bS>=1.5;bn.val(bS);a7.prop("checked",bR);(bR)?bf.addClass("high-dpi"):bf.removeClass("high-dpi");bC=bS})}else{N("#button-type-bar").find("a").eq(0).trigger("click");aT.val(N.trim(bv.text())).focus().select();bf.find("ul.buttons").hide()}}else{if(bx=="auto"){aF("#"+(av?"dynamic":"static")+"_embed_options",true);if(av){var bH=av.substr(1,av.length-2).split(":"),bw=bH[1].split(";"),bL=parseInt(bw.shift(),10),bA=bw.length?bw:null;av={post_type:bH[0],relative:bL,terms:bA};N("#dynamic_embed_options_post_type").val(av.post_type).trigger("change");N("#dynamic_embed_options_relative").val(av.relative).trigger("change")}else{}}else{if(bx=="codeview"){var bF=aO.find("textarea"),bK=bv.clone();aP.modulebuttons=bK.find(".modulebuttons");bK.find(".modulebuttons").remove();var bD=N.trim(bK.html());bF.html(bD);N.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){})}}}}x.addClass("noeditbuttons");bz=x.offset().top+(aP.offset.top-(ac.height()/2)+(aP.height/2));bz=Math.max(x.offset().top-200,bz);c(bz,function(){bf.find("h4.editbar-title").html(bP);bf.find("div.type").hide();bf.find("div."+bx).show();var bU=ad.scrollTop()+(ac.height()/2)-x.offset().top-(bf.height()/2);bf.css({top:bU});aQ();if(bx=="single"){if(bB){N.each(bB,function(bZ,b0){var bY=aO.find(".conditinal-area").eq(bZ);bY.find("select.condition-fields").val(b0.field);bY.find("select.condition-operators").val(b0.operator);bY.find("input.condition-value").val(b0.value);bY.find("input.input").val(b0.html)})}else{var bX=bI.replace(/&amp;/g,"&");if(aP.element.parent().is("a")){var bR=aP.element.parent().attr("href");a8.val(bR!="#"?bR:"")}else{if(aP.element.find("a").length){var bT=aP.element.find("a");if(bX==bT.text()){var bR=bT.attr("href");bX=bT.text();a8.val(bR!="#"?bR:"")}}}aO.find("input").eq(0).val(N.trim(bX))}}else{if(bx=="img"){var bQ=parseInt(bv[0].style.maxWidth,10)||bv.parent().width()||bv.width()||null;var bW=parseInt(bv[0].style.maxHeight,10)||bv.parent().height()||bv.height()||null;var bV=bv.attr("src")||bv.attr("background");var bS=aZ(bV)||"";if(bv.parent().is("a")){aE.val(bv.parent().attr("href").replace("%7B","{").replace("%7D","}"))}aw.val(bv.attr("alt"));bq.val(bS);bt.val(bV);bv.data("id",bv.attr("data-id"));N(".imageurl-popup").toggle(!!bS);a5.removeAttr("src").attr("src",bV);bg="attachment";aI=aO.find(".imagelist");bh={id:bv.data("id"),width:bv.width()*bC,height:bv.height()*bC};bh.asp=bh.width/bh.height;bj()}else{if(bx=="btn"){aD.val(bv.find("img").attr("alt"));if(bv.attr("href")){bp.val(bv.attr("href").replace("%7B","{").replace("%7D","}"))}bg="link";aI=aO.find(".postlist").eq(0);bj();N.each(aO.find(".buttons img"),function(){var bY=N(this);bY.css("background-color",bv.css("background-color"));(bY.attr("src")==by)?bY.parent().addClass("active"):bY.parent().removeClass("active")})}else{if(bx=="auto"){bg="post";aI=aO.find(".postlist").eq(0);bj();aP.elements={headlines:aP.element.find("single"),bodies:aP.element.find("multi"),buttons:aP.element.find("a[editable]"),images:aP.element.find("img[editable]")}}else{if(bx=="codeview"){N.getScript(mailsterdata.url+"assets/js/libs/codemirror.min.js",function(){if(at){at.clearHistory()}at=at||CodeMirror.fromTextArea(bF.get(0),{mode:{name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null},{matches:/(text|application)\/(x-)?vb(a|script)/i,mode:"vbscript"}]},tabMode:"indent",lineNumbers:true,viewportMargin:Infinity,autofocus:true});at.setValue(bD)})}}}}}bf.show(0,function(){if(bx=="single"){bf.find("input").focus().select()}else{if(bx=="img"){aK.val(aP.width);aG.val(aP.height)}else{if(bx=="btn"){aK.val(bQ);aG.val(bW)}else{if(bx=="multi"){N("#mailster-editor").val(bI);if(i&&tinymce.get("mailster-editor")){tinymce.get("mailster-editor").setContent(bI);tinymce.execCommand("mceFocus",false,"mailster-editor")}}}}}});aQ(false)},Math.abs(bz-ad.scrollTop()))}function bj(bu,bx){var bw=N("#post_type_select").find("input:checked").serialize(),bv={type:bg,posttypes:bw,search:ar,offset:0};if(N(this).is("#rss_url")){bv.type="_rss";bv.url=N.trim(N("#rss_url").val());if(bv.url==aB){return false}aB=bv.url;if(!bv.url){N("#rss_more").slideUp(200);return false}N(".rss_info").html("")}if(bg=="attachment"){bv.id=bh.id}aI.empty();aQ();O("get_post_list",bv,function(by){aQ(false);if(by.success){az=by.itemcount;a9(by.html,true);aI.find(".selected").trigger("click");if(by.rssinfo){N("#rss_more").slideDown(200);N("#rss_input").slideUp(200);N(".rss_info").html("<h4>"+by.rssinfo.title+" &ndash; "+by.rssinfo.description+'</h4><p class="tiny">'+by.rssinfo.copyright+"</p>")}bx&&bx()}},function(by,bA,bz){aQ(false);alert(bA+" "+by.status+": "+bz+"\n\n"+mailsterL10n.check_console)})}function bi(){var bw=N(this),bx=bw.data("offset"),bu=bw.data("type");aQ();var bv=N("#post_type_select").find("input:checked").serialize();O("get_post_list",{type:bu,posttypes:bv,search:ar,offset:bx,url:N.trim(N("#rss_url").val()),itemcount:az},function(by){aQ(false);if(by.success){az=by.itemcount;bw.parent().remove();a9(by.html,false)}},function(by,bA,bz){aQ(false);alert(bA+" "+by.status+": "+bz+"\n\n"+mailsterL10n.check_console)});return false}function a4(){var bu=N(this);clearTimeout(aC);aC=setTimeout(function(){var bv=bu.val();if(bv==ar){return}ar=bv;bj()},300)}function aR(){N("#single-link").slideDown(200);a8.focus().select();bg="link";aI=aO.find(".postlist").eq(0);bj();return false}function a9(bv,bu,bw){if(!bw){bw=aI}if(bu){bw.empty()}if(!bw.html()){bw.html("<ul></ul>")}bw.find("ul").append(bv)}function bb(){N("#rss_url").val(N(this).attr("href")).trigger("change");return false}function ax(){N("#rss_url").val("");N("#rss_more").slideUp(200);N("#rss_input").slideDown(200);return false}function aH(){N(".imageurl-popup").toggle();bq.focus().select();return false}function a1(){if(!wp.media.frames.mailster_editbar){wp.media.frames.mailster_editbar=wp.media({title:mailsterL10n.select_image,library:{type:"image"},multiple:false});wp.media.frames.mailster_editbar.on("select",function(){var bv=wp.media.frames.mailster_editbar.state().get("selection").first().toJSON(),bu=N("img").data({id:bv.id,name:bv.name,src:bv.url});bj(null,function(){aL(null,bu)})})}wp.media.frames.mailster_editbar.open()}function a0(bu){clearTimeout(ag);ag=setTimeout(function(){if(!bu){return}var bv=N.trim(bu.save());aP.element.html(bv)},100)}function be(){bf.removeClass("current-"+aP.type).hide();aQ(false);N("#single-link").hide();v();w();return false}bm();return{open:function(bu){aU(bu)},close:function(){be()}}};var an=function(){var aw=N("#mailster_template"),aG=N("#module-selector"),aF=N("a.toggle-modules"),aC=z.contents().find("modules"),aA=z.contents().find("body"),aI=aC.find("module"),aD,at={},aE=!!parseInt(window.getUserSetting("mailstershowmodules",1),10);function av(){var aL=aG.data("current");aq(N(this).data("id"),((aL&&aL.is("module"))?aL:false),true);return false}function ay(){var aL=N(this).parent().parent().parent();aL.insertBefore(aL.prev("module"));w();v();return false}function az(){var aL=N(this).parent().parent().parent();aL.insertAfter(aL.next("module"));w();v();return false}function ar(){var aL=N(this).parent().parent().parent(),aN=aL.clone().hide();x.addClass("noeditbuttons");aN.insertAfter(aL);L(0,0);aN.slideDown(function(){aN.css("display","block");w();v()});var aM=aN.offset().top+x.offset().top-(ac.height()/2)-aN.outerHeight();aM=Math.max(x.offset().top,aM);c(aM);return false}function ax(){var aL=N(this).parent().parent().parent();var aM={element:aL,name:aL.attr("label"),type:"auto",offset:aL.offset()};I.open(aM);return false}function aB(){var aN=N(this),aM=aN.val(),aL=aN.parent().parent();if(!aM){aM=aN.attr("placeholder");aN.val(aM)}aL.attr("label",aM)}function aK(){var aL=N(this).parent().parent().parent();aL.fadeTo(100,0,function(){x.addClass("noeditbuttons");aL.slideUp(200,function(){aL.remove();aI=z.contents().find("module");if(!aI.length){aC.html("")}w();v()})});return false}function aq(aQ,aL,aM,aN){if(!at[aQ]){return false}var aP=at[aQ].el.clone();x.addClass("noeditbuttons");(aL)?(aM?aP.hide().insertBefore(aL):aP.hide().insertAfter(aL)):aP.hide().appendTo(aC);L(0,0);aP.slideDown(200,function(){aP.addClass("active").css("display","block");w();v()});if(!aN){var aO=aP.offset().top+x.offset().top-(ac.height()/2)-aP.outerHeight();aO=Math.max(x.offset().top,aO);c(aO)}}function ap(){var aL=N(this).parent().parent().parent();var aM={element:aL,name:aL.attr("label"),type:"codeview",offset:aL.offset()};I.open(aM);return false}function aJ(){V.toggleClass("show-modules");aE=!aE;window.setUserSetting("mailstershowmodules",aE?1:0);w()}function aH(){x.on("click","a.toggle-modules",aJ).on("click","a.addmodule",av);au()}function au(){aI=z.contents().find("module");if(!aI.length){aC.html("")}aD=N(Z.val()).add(aI);if(!aD.length){aG.remove();return}aC=z.contents().find("modules");aC.on("click","a.up",ay).on("click","a.down",az).on("click","a.auto",ax).on("click","a.duplicate",ar).on("click","a.remove",aK).on("click","a.codeview",ap).on("change","input.modulelabel",aB);var aP="",aL="",aO=0;at=[];N.each(aD,function(aU){var aW=N(this);if(aW.is("module")){var aT=aW.attr("label"),aV=mailsterdata.codeview?'<a class="mailster-btn codeview" title="'+mailsterL10n.codeview+'"></a>':"",aX=(aW.is("[auto]")?'<a class="mailster-btn auto" title="'+mailsterL10n.auto+'"></a>':"");N('<div class="modulebuttons '+(mailsterdata.isrtl?"modulebuttons-rtl":"")+'"><span>'+aX+'<a class="mailster-btn duplicate" title="'+mailsterL10n.duplicate_module+'"></a><a class="mailster-btn up" title="'+mailsterL10n.move_module_up+'"></a><a class="mailster-btn down" title="'+mailsterL10n.move_module_down+'"></a>'+aV+'<a class="mailster-btn remove" title="'+mailsterL10n.remove_module+'"></a></span><input class="modulelabel" type="text" value="'+aT+'" placeholder="'+aT+'" title="'+mailsterL10n.module_label+'" tabindex="-1"></div>').prependTo(aW);if(!aW.parent().length){at.push({name:aT,el:aW})}}});var aR,aN,aM=N("<dropzone></dropzone>"),aS=aM.clone(),aQ=aM.add(aS);if(!N._data(aG[0],"events")){aG.on("dragstart.mailster","li",function(aT){window.mailster_is_modulde_dragging=true;aT.originalEvent.dataTransfer.setData("Text",this.id);x.addClass("noeditbuttons");aA.addClass("drag-active");aN=N(aT.target).data("id");aC.on("dragenter.mailster",function(aU){var aV=N(aU.target).closest("module");if(!aV.length||aR&&aR[0]===aV[0]){return}aR=aV;aS.appendTo(aR);aM.prependTo(aR);setTimeout(function(){aS.addClass("visible");aM.addClass("visible");aI.removeClass("drag-up drag-down");aV.prevAll("module").addClass("drag-up");aV.nextAll("module").addClass("drag-down")},1)}).on("dragover.mailster",function(aU){aU.preventDefault()}).on("drop.mailster",function(aU){aq(aN,aI.length?(aR&&aR[0]===aC?false:aR):false,aM[0]===aU.target,true);aI=z.contents().find("module");aU.preventDefault()});aQ.on("dragenter.mailster",function(aU){N(this).addClass("drag-over")}).on("dragleave.mailster",function(aU){N(this).removeClass("drag-over")})}).on("dragend.mailster","li",function(aT){aR=null;aA.removeClass("drag-active");aQ.removeClass("visible drag-over").remove();aI.removeClass("drag-up drag-down");aC.off("dragenter.mailster").off("dragover.mailster").off("drop.mailster");aQ.off("dragenter.mailster").off("dragleave.mailster");window.mailster_is_modulde_dragging=false})}w()}aH();return{refresh:function(){au()}}};function c(ar,aq,ap){if(isNaN(ap)){ap=400}if(ad.scrollTop()==ar){aq&&aq();return}ad.animate({scrollTop:ar},ap,aq&&function(){aq()})}function w(){clearTimeout(A);A=setTimeout(function(){L();if(!e){if(z[0].contentWindow.window.mailster_refresh){z[0].contentWindow.window.mailster_refresh()}p()}else{d()}},10)}function L(ap,aq){if(!D){return false}setTimeout(function(){if(!z[0].contentWindow.document.body){return}var ar=z[0].contentWindow.document.body.offsetHeight||z.contents().find("html")[0].innerHeight||z.contents().find("html").height();z.attr("height",Math.max(500,ar+10+(ap||0)))},aq?aq:500)}function v(){if(!e&&D){var ar=u();var aq=E.length,ap=E[aq];if(ap!=ar){U.val(ar);X.prop("readonly",!ar.match("{preheader}"));E=E.splice(0,al+1);E.push(n.val()+ar);if(aq>=mailsterL10n.undosteps){E.shift()}al=E.length-1;if(al){r.find("a.undo").removeClass("disabled")}r.find("a.redo").addClass("disabled")}}}function p(){x.find(".content.mailster-btn").remove();var ap=z.contents().find("html");var ar=ap.find("buttons"),aq=ap.find("[repeatable]");if(!ap){return}setTimeout(function(){if(!N._data(ap[0],"events")){ap.off(".mailster").on("click.mailster","multi, single",function(av){av.stopPropagation();var ay=N(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au=ay.prop("tagName").toLowerCase();I.open({offset:az,type:au,name:at,element:ay})}).on("click.mailster","img[editable]",function(av){av.stopPropagation();var ay=N(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";I.open({offset:az,type:au,name:at,element:ay})}).on("click.mailster","td[background]",function(av){av.stopPropagation();if(av.target.tagName.toLowerCase()=="module"||this==ap.find("table").eq(0).find("td")[0]){return}var ay=N(this),az=ay.offset(),ax=az.top+61,aw=az.left,at=ay.attr("label"),au="img";I.open({offset:az,type:au,name:at,element:ay})}).on("click.mailster","a[editable]",function(av){av.stopPropagation();av.preventDefault();var ay=N(this),az=ay.offset(),ax=az.top+40,aw=az.left,at=ay.attr("label"),au="btn";I.open({offset:az,type:au,name:at,element:ay})})}N.each(ar,function(){var ax=N(this),at=ax.attr("label"),ay=this.getBoundingClientRect(),aw=ay.top+46,av=ay.right+16,au;au=N('<a class="addbutton content mailster-btn" title="'+mailsterL10n.add_button+'"></a>').css({top:aw,left:av}).appendTo(x);au.data("offset",ay).data("name",at);au.data("element",ax)});N.each(aq,function(){var ax=N(this),at=ax.attr("label"),ay=this.getBoundingClientRect(),aw=ay.top+48,av=ay.right,au;au=N('<a class="addrepeater content mailster-btn" title="'+q(mailsterL10n.add_s,at)+'"></a>').css({top:aw-3,left:av+18}).appendTo(x);au.data("offset",ay).data("name",at);au.data("element",ax);au=N('<a class="removerepeater content mailster-btn" title="'+q(mailsterL10n.remove_s,at)+'"></a>').css({top:aw+18,left:av+18}).appendTo(x);au.data("offset",ay).data("name",at);au.data("element",ax)});x.removeClass("noeditbuttons")},500)}function d(ap){x.find(".clickbadge").remove();var ap=ap||N("#mailster_click_stats").data("stats"),aq=parseInt(ap.total,10);if(!aq){return}N.each(ap.clicks,function(at,ar){N.each(ar,function(aw,aA){var az=z.contents().find('a[href="'+at.replace("&amp;","&")+'"]').eq(aw);if(az.length){az.css({display:"inline-block"});var av=az.offset(),ay=av.top,au=av.left+5,aC=(aA.clicks/aq)*100,aB=(aC<1?"&lsaquo;1":Math.round(aC))+"%",ax=N('<a class="clickbadge '+(aC<40?"clickbadge-outside":"")+'" data-p="'+aC+'" data-link="'+at+'" data-clicks="'+aA.clicks+'" data-total="'+aA.total+'"><span style="width:'+(Math.max(0,aC-2))+'%">'+(aC<40?"&nbsp;":aB)+"</span>"+(aC<40?" "+aB:"")+"</a>").css({top:ay,left:au}).appendTo(x)}})})}function M(av,au,ar){if(!av){av=au}if(!au){return false}if(av==au){return false}var aq=g(),at=new RegExp(av,"gi"),ap=Z.val();if(ar){ar.data("value",au)}Z.val(ap.replace(at,au));N("#mailster-color-"+av.substr(1).toLowerCase()).attr("id","mailster-color-"+au.substr(1).toLowerCase());Q(aq.replace(at,au),3000)}function ak(ar,ap,aq){if(ap===aq){return ar}do{ar=ar.replace(ap,aq)}while(ar.indexOf(ap)!==-1);return ar}function Y(ar){var ap=g(),aq=ap.replace(/body{background-image:url\(.*}/i,"");if(ar){var at=(ar)?"\tbody{background-image:url('"+ar+"');background-repeat:repeat-y no-repeat;background-position:top center;}":"",aq=aq.replace(/<style.*?>/i,'<style type="text/css">'+at).replace(/<td/i,'<td background="'+ar+'"');N("ul.backgrounds > li > a").css({"background-image":"url('"+ar+"')"})}else{var au=aq.match(/<td(.*)background="[^"]*"(.*)/i);if(au){aq=aq.replace(au[0],"<td "+au[1]+" "+au[2])}N("ul.backgrounds > li > a").css({"background-image":"none"})}Q(aq);return}function H(aq){var ar=g(),at=/\/img\/version(\d+)\//g,au="/img/"+aq+"/";html=ar.replace(at,au);var ap=Z.val();Z.val(ap.replace(at,au));Q(html);return}function G(ap){ai=true;N("#publishing-action").find("input").prop("disabled",true);N(".button").prop("disabled",true);if(ap!==true){N("input").prop("disabled",true)}}function y(){N("#publishing-action").find("input").prop("disabled",false);N(".button").prop("disabled",false);N("input").prop("disabled",false);ai=false}function u(){var ap=z[0].contentWindow.document.body;if(typeof ap=="null"||!ap){return""}var at=N.trim(ap.innerHTML);var au=ap.attributes,aq=au.length,ar="";while(aq--){ar=" "+au[aq].name+'="'+au[aq].value+'"'+ar}ar=ar.replace("position: relative;","").replace(' class=""',"").replace(' style=""',"");return n.val()+"\n<body"+ar+">\n"+at+"\n</body>\n</html>"}function g(){return U.val()||u()}function Q(au,ar,at){var aq=au.match(/([^]*)<body([^>]*)?>([^]*)<\/body>([^]*)/m),au=aq?aq[3]:"<multi>"+au+"</multi>",aw=aq?N.trim(aq[1]):"",az=aq?N("<div"+(aq[2]||"")+"></div>")[0].attributes:"",ax=az.length,ay=(N.browser.webkit||N.browser.mozilla)?z[0].contentWindow.document:m,ap=N(ay).find("head").find("link"),av=ay.getElementsByTagName("head")[0];n.val(aw);av.innerHTML=aw.replace(/([^]*)<head([^>]*)?>([^]*)<\/head>([^]*)/m,"$3");N(av).append(ap);ay.body.innerHTML=am(au);while(ax--){ay.body.setAttribute(az[ax].name,az[ax].value)}if(ar!==false){clearTimeout(ag);ag=setTimeout(function(){F.refresh()},ar||100)}if(typeof at=="undefined"||at===true){v()}}function am(ap){return ap}function P(){return S.val()+U.val()+a.val()+K.val()+X.val()}function O(at,ar,au,aq,ap){if(N.isFunction(ar)){if(N.isFunction(au)){aq=au}au=ar;ar={}}N.ajax({type:"POST",url:ajaxurl,data:N.extend({action:"mailster_"+at,_wpnonce:B},ar),success:function(aw,ax,av){au&&au.call(this,aw,ax,av)},error:function(av,ax,aw){if(ax=="error"&&!aw){return}if(console){console.error(N.trim(av.responseText))}aq&&aq.call(this,av,ax,aw)},dataType:ap?ap:"JSON"})}function o(ap){return N.trim(ap).toLowerCase().replace(/ /g,"_").replace(/[^a-z0-9_-]*/g,"")}function ae(){var aD,az,av,aq,aw=new Date(),ap=N(".time"),ar=N(".deliverytime").eq(0),ay=N("#mailster_data_active"),aC=parseInt(ap.data("timestamp"),10)*1000,aB=true,at=aC-aw.getTime()+(aw.getTimezoneOffset()*60000);var au=(aB)?1000:20000;function aA(){aD=new Date();aw=aD.getTime();aD.setTime(aw+at);av=aD.getHours();aq=aD.getMinutes();if(!e&&az&&aq!=az[1]&&!ay.is(":checked")){ar.val(ax(av)+":"+ax(aq))}az=[];az.push(aD.getHours());az.push(aD.getMinutes());if(aB){az.push(aD.getSeconds())}for(var aE=0;aE<3;aE++){az[aE]=ax(az[aE])}ap.html(az.join('<span class="blink">:</span>'));setTimeout(function(){aA()},au)}function ax(aE){return(aE<10)?"0"+aE:aE}aA()}function q(){var ap=Array.prototype.slice.call(arguments),au=ap.shift(),at=ap.length,ar;for(var aq=0;aq<at;aq++){ar=new RegExp("%("+(aq+1)+"\\$)?(s|d|f)");au=au.replace(ar,ap[aq])}return au}function aj(aq,at){aq=aq.eq(0);if(aq.is("img")&&aq.attr("src")){var ar=new Image(),ap;ar.onload=function(){ap=((ar.width/aq.width()).toFixed(1)||1);if(at){at.call(this,ar.width,ar.height,isFinite(ap)?parseFloat(ap):1)}};ar.src=aq.attr("src")}}function k(ar,aq,ap,at){return(at===false?"":"#")+((1<<24)+(ar<<16)+(aq<<8)+ap).toString(16).slice(1)}if(document.selection&&document.selection.createRange){j=function(aq,at,ar){aq.focus();aq.select();var ap=document.selection.createRange();ap.collapse(true);ap.moveEnd("character",ar);ap.moveStart("character",at);ap.select();return true}}else{j=function(ap,ar,aq){ap.selectionStart=ar;ap.selectionEnd=aq;return true}}if(window.getSelection){t=function(aq){var at="";if(document.activeElement&&(document.activeElement.tagName.toLowerCase()=="textarea"||document.activeElement.tagName.toLowerCase()=="input")){var ar=document.activeElement.value;at=ar.substring(document.activeElement.selectionStart,document.activeElement.selectionEnd)}else{var ap=window.getSelection();at=ap.toString()}return at}}else{t=function(aq){var ar="";if(document.selection.createRange){var ap=document.selection.createRange();ar=ap.text}return ar}}window.tb_position=function(){if(!window.TB_WIDTH||!window.TB_HEIGHT){return}var ap=typeof document.body.style.maxHeight==="undefined";jQuery("#TB_window").css({marginLeft:"-"+parseInt((TB_WIDTH/2),10)+"px",width:TB_WIDTH+"px"});if(!ap){jQuery("#TB_window").css({marginTop:"-"+parseInt((TB_HEIGHT/2),10)+"px"})}};ah()});