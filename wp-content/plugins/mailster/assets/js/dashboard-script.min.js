jQuery(document).ready(function(j){var m=j("#mailster_nonce").val(),p=j(document.body).hasClass("mobile"),a=j(".postbox .handlediv"),f=j(".mailster-db-subscribers"),l=j("#mailster-subscriber-range"),b=j("#subscriber-chart-wrap"),e=j("#subscriber-chart"),o,r,h={responsive:true,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(w,v){return d(w.yLabel)}}},scales:{xAxes:[{ticks:{maxTicksLimit:20}}],yAxes:[{ticks:{callback:d}}]}};if(e.length){r=e[0].getContext("2d")}l.on("change",function(){s()}).trigger("change");j("a.external").on("click",function(){window.open(this.href);return false});j(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:(p?200:0),distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(w,v){return v.clone().find(":input").attr("name",function(y,x){return"sort_"+parseInt(Math.random()*100000,10).toString()+"_"+x}).end()},opacity:0.65,update:function(w,v){q()}});j(".postbox .handlediv").each(function(){var v=j(this);v.attr("aria-expanded",!v.parent(".postbox").hasClass("closed"))}).on("click",function(){var v=j(this);v.parent(".postbox").toggleClass("closed");v.attr("aria-expanded",!v.parent(".postbox").hasClass("closed"))});j(document).on("verified.mailster",function(){j("#mailster-mb-mailster").addClass("verified");j("#welcome-panel").delay(2500).fadeTo(400,0,function(){j("#welcome-panel").slideUp(400)})}).on("click",".toggle-indicator",u).on("click",".hide-postbox-tog",function(){j("#"+j(this).val())[j(this).is(":checked")?"show":"hide"]().removeClass("closed");u()}).on("click",".locked",function(){j(".purchasecode").focus().select()}).on("click",".reset-license",function(){if(!confirm(mailsterdashboardL10n.reset_license)){return false}});var k=(function(x){if(!x){return}var B,A=j(".mailster-mb-"+x),C=A.find(".mailster-mb-select"),w=A.find(".mailster-mb-label"),z=A.find(".mailster-mb-link"),v=z.attr("href");if(!C.length){return}C.on("change",function(){y(j(this).val())}).trigger("change");j(document).on("heartbeat-tick",function(E,D){if(B){y(B,true)}});A.find(".piechart").easyPieChart({animate:1000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(D){this.$el.find("span").text(Math.round(D))},onStop:function(D){this.$el.find("span").text(Math.round(D))}});function y(D,E){if(!E){A.addClass("loading")}c("get_dashboard_data",{type:x,id:D},function(F){var G=F.data;z.html(G.name).removeAttr("class").addClass("mailster-mb-link").attr("href",v.replace("%d",G.ID));if(G.status){z.addClass("status-"+G.status)}A.find(".stats-total").html(G.sent_formated);A.find(".stats-open").data("easyPieChart").update(G.openrate*100);A.find(".stats-clicks").data("easyPieChart").update(G.clickrate*100);A.find(".stats-unsubscribes").data("easyPieChart").update(G.unsubscriberate*100);A.find(".stats-bounces").data("easyPieChart").update(G.bouncerate*100);B=G.ID;A.removeClass("loading")})}});var n=new k("campaigns");var i=new k("lists");function s(w,y,v,x){f.addClass("loading");c("get_dashboard_chart",{range:l.val()},function(z){g();f.removeClass("loading");if(!o){o=new Chart(r,{type:"line",data:z.chart,options:h})}})}function g(){o=null;if(e){e.remove()}e=j("<canvas>").prependTo(b);r=e[0].getContext("2d");e.attr({width:b.width(),height:b.height()})}function t(){q();u()}function q(){var v={};j.each(j(".postbox-container"),function(){var x=j(this).data("id");j.each(j(this).find(".postbox"),function(){if(!v[x]){v[x]=[]}v[x].push(this.id)});if(v[x]){v[x]=v[x].join(",")}});var w={action:"meta-box-order",_ajax_nonce:j("#meta-box-order-nonce").val(),page:"newsletter_page_mailster_dashboard",order:v};j.post(ajaxurl,w)}function u(){var x=j(".postbox:hidden").map(function(){return this.id}).toArray(),v=j(".postbox.closed").map(function(){return this.id}).toArray();var w={action:"closed-postboxes",closedpostboxesnonce:j("#closedpostboxesnonce").val(),closed:v.length?v.join(","):"",hidden:x.length?x.join(","):"",page:"newsletter_page_mailster_dashboard"};j.post(ajaxurl,w)}function d(v){if(v>=1000000){return(v/1000).toFixed(1)+"M"}else{if(v>=1000){return(v/1000).toFixed(1)+"K"}}return !(v%1)?v:""}function c(y,x,z,w,v){if(j.isFunction(x)){if(j.isFunction(z)){w=z}z=x;x={}}j.ajax({type:"POST",url:ajaxurl,data:j.extend({action:"mailster_"+y,_wpnonce:m},x),success:function(B,C,A){z&&z.call(this,B,C,A)},error:function(A,C,B){if(C=="error"&&!B){return}if(console){console.error(j.trim(A.responseText))}w&&w.call(this,A,C,B)},dataType:v?v:"JSON"})}});